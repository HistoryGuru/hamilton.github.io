<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamilton – Intelligent Debate Speech Generator</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
[contenteditable]:empty:before {
    content: attr(data-placeholder);
    color: #94a3b8;
    font-style: italic;
}
mark {
    background-color: yellow;
    color: black;
}
.generated-case strong {
    color: #fbbf24;
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
<div class="max-w-6xl mx-auto">

<header class="text-center mb-8">
    <h1 class="text-5xl font-bold text-amber-400">Hamilton</h1>
    <p class="text-slate-300">Intelligent Debate Speech Generator</p>
</header>

<!-- Tabs -->
<div class="flex gap-4 mb-6 justify-center">
    <button id="counterTab" class="px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold">
        Counter-Speech Generator
    </button>
    <button id="caseTab" class="px-6 py-3 rounded bg-slate-800 text-slate-300">
        Write Me a Case
    </button>
</div>

<!-- COUNTER SPEECH -->
<div id="counterSection">
<div class="grid md:grid-cols-2 gap-6">

<!-- INPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Case Input</h2>

    <div id="caseInput" contenteditable
        class="bg-slate-900 h-64 p-4 rounded border border-slate-600 text-slate-100 overflow-y-auto"
        data-placeholder="Paste your formatted debate case here...">
    </div>

    <label class="block text-slate-300 mt-4">
        Speech Length: <span id="speechLengthDisplay">3</span> minutes
    </label>
    <input id="speechLength" type="range" min="1" max="8" value="3" class="w-full">

    <button id="generateCounterBtn"
        class="w-full mt-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-3 rounded">
        Generate Counter-Speech
    </button>
</div>

<!-- OUTPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Counter-Speech</h2>
    <div class="bg-slate-900 p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <p id="counterOutput" class="text-slate-400 italic">
            Your generated counter-speech will appear here…
        </p>
    </div>
</div>

</div>
</div>

<!-- CASE WRITER -->
<div id="caseSection" class="hidden">
<div class="grid md:grid-cols-2 gap-6">

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <input id="topic"
        class="w-full p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Topic / Resolution">

    <div class="flex gap-2 mt-3">
        <button id="affBtn" class="flex-1 bg-amber-500 py-2 rounded font-semibold">
            Affirmative
        </button>
        <button id="negBtn" class="flex-1 bg-slate-700 py-2 rounded text-slate-300">
            Negative
        </button>
    </div>

    <input id="focusPoint1"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded"
        placeholder="Focus Point 1 (Required)">

    <input id="focusPoint2"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded"
        placeholder="Focus Point 2 (Optional)">

    <button id="generateCaseBtn"
        class="w-full mt-4 bg-amber-500 py-3 rounded font-semibold text-slate-900">
        Generate Case
    </button>
</div>

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Generated Case</h2>
    <div class="bg-slate-900 p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <div id="caseOutput" class="text-slate-300 italic generated-case">
            Your generated case will appear here…
        </div>
    </div>
</div>

</div>
</div>

</div>

<script>
/* =========================================================
   CENTRALIZED AI CALL (BACKEND)
   ========================================================= */
async function callAI(system, user, maxTokens = 1200) {
    const response = await fetch("/api/ai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            model: "gpt-4.1-mini",
            messages: [
                { role: "system", content: system },
                { role: "user", content: user }
            ],
            temperature: 0.7,
            max_tokens: maxTokens
        })
    });

    if (!response.ok) {
        throw new Error("AI request failed");
    }

    const data = await response.json();
    return data.choices[0].message.content;
}

/* =========================================================
   TAB LOGIC
   ========================================================= */
counterTab.onclick = () => {
    counterSection.classList.remove("hidden");
    caseSection.classList.add("hidden");
};
caseTab.onclick = () => {
    caseSection.classList.remove("hidden");
    counterSection.classList.add("hidden");
};

/* =========================================================
   COUNTER SPEECH
   ========================================================= */
speechLength.oninput = e =>
    speechLengthDisplay.textContent = e.target.value;

generateCounterBtn.onclick = async () => {
    counterOutput.textContent = "Generating…";

    const prompt = `
Generate a ${speechLength.value}-minute rebuttal speech
against the following case:

${caseInput.innerText}

Be structured, analytical, and persuasive.
    `;

    try {
        const text = await callAI(
            "You are a high-level debate coach.",
            prompt,
            speechLength.value * 180
        );
        counterOutput.innerText = text;
    } catch (err) {
        counterOutput.innerText = err.message;
    }
};

/* =========================================================
   CASE GENERATOR
   ========================================================= */
let side = "Aff";
affBtn.onclick = () => side = "Aff";
negBtn.onclick = () => side = "Neg";

generateCaseBtn.onclick = async () => {
    caseOutput.innerText = "Generating…";

    const prompt = `
Write a complete ${side} debate case on:
"${topic.value}"

Focus points:
${focusPoint1.value}
${focusPoint2.value || ""}

Use HTML formatting:
- <strong>
