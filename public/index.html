<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamilton – Intelligent Debate Speech Generator</title>

<script src="https://js.puter.com/v2/"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
[contenteditable]:empty:before {
    content: attr(data-placeholder);
    color: #94a3b8;
    font-style: italic;
}

/* Debate Card Styling */
.debate-card {
    font-family: 'Times New Roman', serif;
    line-height: 1.6;
    color: #1e293b;
    margin-bottom: 1.5em;
}

.debate-card .tag {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 0.5em;
    display: block;
}

.debate-card .cite {
    font-size: 0.95em;
    margin-bottom: 0.3em;
}

.debate-card .author {
    font-weight: normal;
}

.debate-card .year {
    font-weight: normal;
}

.debate-card mark {
    background-color: #7dd3fc;
    color: black;
    padding: 0;
}

/* Remove white/transparent highlighting */
.debate-card mark[style*="background-color: white"],
.debate-card mark[style*="background-color: #fff"],
.debate-card mark[style*="background-color: #ffffff"],
.debate-card mark[style*="background: white"],
.debate-card mark[style*="background: #fff"],
.debate-card mark[style*="background: #ffffff"] {
    background-color: transparent !important;
    background: transparent !important;
}

.debate-card u {
    text-decoration: underline;
}

.debate-card strong {
    font-weight: bold;
}

.debate-card .card-text {
    margin-top: 0.5em;
}

.debate-card .shrunk {
    font-size: 0.75em;
    line-height: 1.3;
    color: #64748b;
}

/* Modal Overlay */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal-content {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border-radius: 16px;
    padding: 32px;
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    border: 2px solid #fbbf24;
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
<div class="max-w-6xl mx-auto pb-16">

<header class="text-center mb-8">
    <h1 class="text-5xl font-bold text-amber-400">Hamilton</h1>
    <p class="text-slate-300">Intelligent Debate Speech Generator</p>
    <p class="text-slate-400 text-sm mt-2" id="planIndicator">Novice Plan (Free)</p>
</header>

<!-- Tabs -->
<div class="flex gap-4 mb-6 justify-center">
    <button id="counterTab" class="px-6 py-3 rounded bg-slate-800 text-slate-300">
        Counter-Speech Generator
    </button>
    <button id="caseTab" class="px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold">
        Write Me a Case
    </button>
</div>

<!-- COUNTER SPEECH -->
<div id="counterSection" class="hidden">
<div class="grid md:grid-cols-2 gap-6">

<!-- INPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Case Input</h2>

    <div id="caseInput" contenteditable
        class="bg-slate-900 h-64 p-4 rounded border border-slate-600 text-slate-100 overflow-y-auto"
        data-placeholder="Paste your formatted debate case here...">
    </div>

    <label class="block text-slate-300 mt-4">
        Speech Length: <span id="speechLengthDisplay">3</span> minutes
    </label>
    <input id="speechLength" type="range" min="1" max="8" value="3" class="w-full">

    <div class="mt-4">
        <label class="block text-slate-300 mb-2">Response Format:</label>
        <div class="flex gap-2">
            <button id="paragraphBtn" class="flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900">
                Paragraph
            </button>
            <button id="caseResponseBtn" class="flex-1 bg-slate-700 py-2 rounded text-slate-300">
                Evidence Case
            </button>
        </div>
    </div>

    <button id="generateCounterBtn"
        class="w-full mt-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-3 rounded">
        Generate Counter-Speech
    </button>
</div>

<!-- OUTPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Counter-Speech</h2>
    <div class="bg-white p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <p id="counterOutput" class="text-slate-400 italic">
            Your generated counter-speech will appear here…
        </p>
    </div>
</div>

</div>
</div>

<!-- CASE WRITER -->
<div id="caseSection">
<div class="grid md:grid-cols-2 gap-6">

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <input id="topic"
        class="w-full p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Topic / Resolution">

    <div class="flex gap-2 mt-3">
        <button id="affBtn" class="flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900">
            Affirmative
        </button>
        <button id="negBtn" class="flex-1 bg-slate-700 py-2 rounded text-slate-300">
            Negative
        </button>
    </div>

    <input id="focusPoint1"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Focus Point 1 (Required)">

    <div class="flex items-center gap-2 mt-2">
        <label class="text-slate-300 text-sm">Cards:</label>
        <input id="cardsPerPoint1" type="number" min="1" max="5" value="2"
            class="w-16 p-1 bg-slate-900 border border-slate-600 rounded text-slate-100 text-center">
    </div>

    <input id="focusPoint2"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Focus Point 2 (Optional)">

    <div class="flex items-center gap-2 mt-2">
        <label class="text-slate-300 text-sm">Cards:</label>
        <input id="cardsPerPoint2" type="number" min="1" max="5" value="2"
            class="w-16 p-1 bg-slate-900 border border-slate-600 rounded text-slate-100 text-center">
    </div>

    <button id="generateCaseBtn"
        class="w-full mt-4 bg-amber-500 hover:bg-amber-600 py-3 rounded font-semibold text-slate-900">
        Generate Case
    </button>
</div>

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Generated Case</h2>
    <div class="bg-white p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <div id="caseOutput" class="text-slate-500 italic">
            Your generated case will appear here…
        </div>
    </div>
</div>

</div>
</div>

</div>

<!-- Upgrade Modal -->
<div id="upgradeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-md">
        <h2 class="text-2xl font-bold text-amber-400 text-center mb-4">Upgrade Required</h2>
        <p class="text-slate-300 text-center mb-6" id="upgradeMessage"></p>
        <button class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded" onclick="closeUpgradeModal()">
            Close
        </button>
    </div>
</div>

<!-- Footer -->
<footer class="fixed bottom-0 left-0 right-0 bg-slate-900/90 border-t border-slate-700 py-2 text-center">
    <p class="text-slate-400 text-sm">All Code by Leroy Qu</p>
</footer>

<script>
// User plan
let userPlan = {
    type: 'novice',
    maxCards: 2
};

// Check card limits
function checkCardLimit() {
    const cards1 = parseInt(document.getElementById('cardsPerPoint1').value) || 0;
    const cards2 = parseInt(document.getElementById('cardsPerPoint2').value) || 0;
    
    if (cards1 > userPlan.maxCards || cards2 > userPlan.maxCards) {
        showUpgradeModal(`Your plan allows a maximum of ${userPlan.maxCards} cards per focus point. Upgrade to Varsity for up to 5 cards!`);
        return false;
    }
    return true;
}

function showUpgradeModal(message) {
    document.getElementById('upgradeMessage').textContent = message;
    document.getElementById('upgradeModal').style.display = 'flex';
}

window.closeUpgradeModal = function() {
    document.getElementById('upgradeModal').style.display = 'none';
};

/* =========================================================
   CENTRALIZED AI CALL (PUTER AI)
   ========================================================= */
async function callAI(system, user, maxTokens = 1200) {
    try {
        const response = await puter.ai.chat([
            { role: "system", content: system },
            { role: "user", content: user }
        ], {
            model: "claude-sonnet-4-20250514",
            temperature: 0.7,
            max_tokens: maxTokens
        });

        console.log("Puter AI Response:", response);

        if (response.message && response.message.content) {
            if (Array.isArray(response.message.content)) {
                return response.message.content
                    .filter(block => block.type === 'text')
                    .map(block => block.text)
                    .join('\n');
            }
            return response.message.content;
        }
        
        if (typeof response === 'string') {
            return response;
        } else if (response.text) {
            return response.text;
        } else if (response.content) {
            return response.content;
        }
        
        return JSON.stringify(response, null, 2);
    } catch (error) {
        console.error("AI Error:", error);
        throw new Error("AI request failed: " + error.message);
    }
}

/* =========================================================
   TAB LOGIC
   ========================================================= */
document.getElementById('counterTab').onclick = () => {
    document.getElementById('counterSection').classList.remove("hidden");
    document.getElementById('caseSection').classList.add("hidden");
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold";
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-slate-800 text-slate-300";
};

document.getElementById('caseTab').onclick = () => {
    document.getElementById('caseSection').classList.remove("hidden");
    document.getElementById('counterSection').classList.add("hidden");
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold";
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-slate-800 text-slate-300";
};

/* =========================================================
   COUNTER SPEECH
   ========================================================= */
let responseFormat = "paragraph"; // "paragraph" or "case"

document.getElementById('paragraphBtn').onclick = () => {
    responseFormat = "paragraph";
    document.getElementById('paragraphBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('caseResponseBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};

document.getElementById('caseResponseBtn').onclick = () => {
    responseFormat = "case";
    document.getElementById('caseResponseBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('paragraphBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};

document.getElementById('speechLength').oninput = e =>
    document.getElementById('speechLengthDisplay').textContent = e.target.value;

document.getElementById('generateCounterBtn').onclick = async () => {
    const counterOutput = document.getElementById('counterOutput');
    const caseInput = document.getElementById('caseInput');
    const speechLength = document.getElementById('speechLength');
    
    // Validation
    if (!caseInput.innerText.trim()) {
        counterOutput.textContent = "Please paste a case first!";
        counterOutput.className = "text-red-400";
        return;
    }
    
    counterOutput.textContent = "Generating…";
    counterOutput.className = "text-slate-400 italic";

    let prompt, systemPrompt;

    if (responseFormat === "paragraph") {
        // Traditional paragraph response
        prompt = `Generate a ${speechLength.value}-minute rebuttal speech against the following case:

${caseInput.innerText}

Be structured, analytical, and persuasive.`;
        systemPrompt = "You are a high-level debate coach.";
    } else {
        // Case-style response with evidence cards
        prompt = `You are responding to the following debate case. Generate a counter-case with evidence cards that refutes their arguments.

OPPONENT'S CASE:
${caseInput.innerText}

CRITICAL FORMATTING REQUIREMENTS:

Create HALF the number of evidence cards as the opponent's case (aim for 2-4 cards total). Each card should directly refute a key argument from their case.

Use this EXACT format for each evidence card:

<div class="debate-card">
<span class="tag"><strong>[Refutation Tag - what you're countering]</strong></span>
<p class="cite"><span class="author">Author</span> '<span class="year">YY</span> <span class="qualification">[Full credentials, title, institution, date, publication/source]</span></p>
<div class="card-text">
<span class="shrunk">[Less important context text in smaller font] </span><mark><u><strong>the most crucial counterarguments are highlighted</strong></u></mark><span class="shrunk"> [more context] </span><mark><u>and key refutations are marked</u></mark><span class="shrunk"> [concluding context]</span>. <mark><u><strong>The highlighted text must flow smoothly</strong></u></mark><span class="shrunk"> and form complete arguments when read alone.</span>
</div>
</div>

REQUIREMENTS:
1. Use <strong> for bold, <u> for underline, <mark> for highlighting
2. Apply <span class="shrunk"> to less important text
3. Highlight ONLY the most important phrases that flow together
4. Format citation as: Author 'YY [full qualifications]
5. Include full article context but shrink unimportant parts
6. Highlighted portions should read smoothly on their own
7. Keep it CONCISE - about half the length of their case
8. Each card should directly refute one of their main arguments

Generate the counter-case with proper HTML formatting.`;
        systemPrompt = "You are an expert debate case writer who creates compelling refutations with properly formatted evidence cards.";
    }

    try {
        const text = await callAI(
            systemPrompt,
            prompt,
            responseFormat === "paragraph" ? parseInt(speechLength.value) * 180 : 2000
        );
        
        if (responseFormat === "case") {
            counterOutput.innerHTML = text;
        } else {
            counterOutput.innerText = text;
        }
        counterOutput.className = "text-slate-100";
    } catch (err) {
        counterOutput.innerText = `Error: ${err.message}`;
        counterOutput.className = "text-red-400";
    }
};

/* =========================================================
   CASE GENERATOR
   ========================================================= */
let side = "Aff";

document.getElementById('affBtn').onclick = () => {
    side = "Aff";
    document.getElementById('affBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('negBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};

document.getElementById('negBtn').onclick = () => {
    side = "Neg";
    document.getElementById('negBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('affBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};

document.getElementById('generateCaseBtn').onclick = async () => {
    const caseOutput = document.getElementById('caseOutput');
    const topic = document.getElementById('topic');
    const focusPoint1 = document.getElementById('focusPoint1');
    const focusPoint2 = document.getElementById('focusPoint2');
    const cardsPerPoint1 = document.getElementById('cardsPerPoint1');
    const cardsPerPoint2 = document.getElementById('cardsPerPoint2');
    
    // Validation
    if (!topic.value.trim()) {
        caseOutput.innerHTML = "<p class='text-red-500'>Please enter a topic/resolution first!</p>";
        return;
    }
    
    if (!focusPoint1.value.trim()) {
        caseOutput.innerHTML = "<p class='text-red-500'>Please enter at least one focus point!</p>";
        return;
    }
    
    // Check card limits
    if (!checkCardLimit()) {
        return;
    }
    
    caseOutput.innerHTML = "<p class='text-slate-500 italic'>Generating your debate case...</p>";

    const focusPoints = [];
    if (focusPoint1.value.trim()) {
        focusPoints.push({
            point: focusPoint1.value.trim(),
            cards: parseInt(cardsPerPoint1.value) || 2
        });
    }
    if (focusPoint2.value.trim()) {
        focusPoints.push({
            point: focusPoint2.value.trim(),
            cards: parseInt(cardsPerPoint2.value) || 2
        });
    }

    const prompt = `You are an expert debate case writer. Write a complete ${side} debate case on: "${topic.value}"

CRITICAL FORMATTING REQUIREMENTS:

For each contention/focus point, create the specified number of evidence cards in this EXACT format:

<div class="debate-card">
<span class="tag"><strong>[Compelling Tag Line]</strong></span>
<p class="cite"><span class="author">Author</span> '<span class="year">YY</span> <span class="qualification">[Full credentials, title, institution, date, publication/source]</span></p>
<div class="card-text">
<span class="shrunk">[Less important context text in smaller font] </span><mark><u><strong>the most crucial points are highlighted</strong></u></mark><span class="shrunk"> [more context] </span><mark><u>and key evidence is marked</u></mark><span class="shrunk"> [concluding context]</span>. <mark><u><strong>The highlighted text must flow smoothly</strong></u></mark><span class="shrunk"> and form complete arguments when read alone.</span>
</div>
</div>

REQUIREMENTS:
1. Use <strong> for bold, <u> for underline, <mark> for highlighting
2. Apply <span class="shrunk"> to less important text
3. Highlight ONLY the most important phrases that flow together
4. Format citation as: Author 'YY [full qualifications]
5. Include full article context but shrink unimportant parts
6. Highlighted portions should read smoothly on their own
7. Use all three formatting types (bold, underline, highlight) strategically

Focus Points and Card Counts:
${focusPoints.map((fp, i) => `${i+1}. ${fp.point} (${fp.cards} cards)`).join('\n')}

Generate the complete case with proper HTML formatting.`;

    try {
        const text = await callAI(
            "You are an expert debate case writer who formats evidence cards in proper debate style with highlighting, underlining, and strategic text sizing.",
            prompt,
            3000
        );
        caseOutput.innerHTML = text;
    } catch (err) {
        caseOutput.innerHTML = `<p class="text-red-500">Error: ${err.message}</p>`;
    }
};

// Check card inputs when they change
document.getElementById('cardsPerPoint1').onchange = checkCardLimit;
document.getElementById('cardsPerPoint2').onchange = checkCardLimit;

console.log("Hamilton initialized successfully!");
</script>

</body>
</html>
