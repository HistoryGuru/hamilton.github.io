<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HamiltonPro ‚Äì The Advanced Debate Coach</title>

<script src="https://js.puter.com/v2/"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

<style>
[contenteditable]:empty:before {
    content: attr(data-placeholder);
    color: #94a3b8;
    font-style: italic;
}

.debate-card {
    font-family: 'Times New Roman', serif;
    line-height: 1.6;
    color: #1e293b;
    margin-bottom: 1.5em;
}

.debate-card .tag {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 0.5em;
    display: block;
}

.debate-card .cite {
    font-size: 0.95em;
    margin-bottom: 0.3em;
}

.debate-card mark {
    background-color: #7dd3fc;
    color: black;
    padding: 0;
}

.debate-card mark[style*="background-color: white"],
.debate-card mark[style*="background-color: #fff"],
.debate-card mark[style*="background-color: #ffffff"] {
    background-color: transparent !important;
}

.debate-card u {
    text-decoration: underline;
}

.debate-card strong {
    font-weight: bold;
}

.debate-card .card-text {
    margin-top: 0.5em;
}

#hamilton-container {
    position: fixed;
    right: 40px;
    bottom: 90px;
    z-index: 20;
    cursor: pointer;
    pointer-events: auto;
    transition: transform 0.2s;
}

#hamilton-container:hover {
    transform: scale(1.1);
}

#hamilton-click-prompt {
    position: fixed;
    right: 45px;
    bottom: 250px;
    z-index: 21;
    color: #1e293b;
    font-weight: bold;
    font-size: 14px;
    text-align: center;
    animation: bounce 1s infinite;
    pointer-events: none;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

#tutorial-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 10000;
    display: none;
    pointer-events: none;
}

#tutorial-spotlight {
    position: absolute;
    background: rgba(255, 255, 255, 0.1);
    border: 3px solid #fbbf24;
    border-radius: 8px;
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
    transition: all 0.5s ease;
    pointer-events: none;
}

#tutorial-dialog {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 20px 30px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    z-index: 10002;
    text-align: center;
    display: none;
    cursor: pointer;
    pointer-events: auto;
}

#tutorial-dialog p {
    margin: 0;
    font-size: 16px;
    color: #1e293b;
    line-height: 1.6;
}

#tutorial-dialog .continue-hint {
    margin-top: 10px;
    font-size: 12px;
    color: #64748b;
    font-style: italic;
}

.word-display {
    font-size: 4rem;
    font-weight: bold;
    text-align: center;
    min-height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}
</style>
</head>

<body class="min-h-screen p-6" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 50%, #8b5cf6 100%); position: relative;">

<!-- Hamilton Click Prompt -->
<div id="hamilton-click-prompt">‚Üì click here ‚Üì</div>

<!-- Hamilton Container -->
<div id="hamilton-container">
<svg id="hamilton" width="100" height="150" viewBox="0 0 100 150">
    <ellipse cx="50" cy="35" rx="18" ry="22" fill="#d4a574" stroke="#000" stroke-width="2"/>
    <path d="M 32 20 Q 28 25 28 35 L 28 45 Q 30 40 32 35 Z" fill="#1a1a1a"/>
    <path d="M 68 20 Q 72 25 72 35 L 72 45 Q 70 40 68 35 Z" fill="#1a1a1a"/>
    <ellipse cx="50" cy="18" rx="20" ry="8" fill="#1a1a1a"/>
    <path d="M 44 48 L 44 52 Q 50 55 56 52 L 56 48 Q 50 51 44 48 Z" fill="#1a1a1a"/>
    <path d="M 35 60 L 20 90 L 15 130 L 30 125 L 35 100 Z" fill="#1e3a5f"/>
    <path d="M 35 60 L 35 100 L 30 125 L 35 130 L 50 135 L 65 130 L 70 125 L 65 100 L 65 60 Z" fill="#f5f5dc"/>
    <path d="M 65 60 L 80 90 L 85 130 L 70 125 L 65 100 Z" fill="#1e3a5f"/>
    <path d="M 40 58 L 35 60 L 40 65 L 45 60 Z" fill="white"/>
    <path d="M 60 58 L 65 60 L 60 65 L 55 60 Z" fill="white"/>
    <circle cx="50" cy="75" r="2.5" fill="#d4a574"/>
    <circle cx="50" cy="85" r="2.5" fill="#d4a574"/>
    <circle cx="50" cy="95" r="2.5" fill="#d4a574"/>
    <circle cx="50" cy="105" r="2.5" fill="#d4a574"/>
    <path d="M 20 90 L 10 105 L 8 115 L 15 118 L 20 110" fill="#1e3a5f"/>
    <path d="M 80 90 L 90 105 L 92 115 L 85 118 L 80 110" fill="#1e3a5f"/>
    <ellipse cx="12" cy="116" rx="5" ry="6" fill="#d4a574"/>
    <ellipse cx="88" cy="116" rx="5" ry="6" fill="#d4a574"/>
</svg>
</div>

<!-- Tutorial Overlay -->
<div id="tutorial-overlay">
    <div id="tutorial-spotlight"></div>
</div>

<div id="tutorial-dialog">
    <p id="tutorial-text"></p>
    <p class="continue-hint">[Click anywhere to continue]</p>
</div>

<div id="mainApp" class="max-w-6xl mx-auto pb-16" style="position: relative; z-index: 1;">

<header class="text-center mb-8" id="main-header">
    <h1 class="text-5xl font-bold text-white mb-2">HamiltonPro</h1>
    <p class="text-purple-200 text-lg">The Advanced Debate Coach</p>
</header>

<!-- Tabs -->
<div class="flex gap-4 mb-6 justify-center flex-wrap">
    <button id="counterTab" class="px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300">
        Counter-Speech Generator
    </button>
    <button id="caseTab" class="px-6 py-3 rounded bg-purple-900 text-white font-semibold border-2 border-purple-900">
        Write Me a Case
    </button>
    <button id="drillsTab" class="px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300">
        Drills
    </button>
</div>

<!-- COUNTER SPEECH -->
<div id="counterSection" class="hidden">
<div class="grid md:grid-cols-2 gap-6">

<div class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl">
    <h2 class="text-xl font-semibold text-purple-900 mb-3">Case Input</h2>

    <div id="caseInput" contenteditable
        class="bg-white h-64 p-4 rounded border-2 border-purple-200 text-slate-900 overflow-y-auto"
        data-placeholder="Paste your formatted debate case here...">
    </div>

    <label class="block text-purple-900 mt-4">
        Speech Length: <span id="speechLengthDisplay">3</span> minutes
    </label>
    <input id="speechLength" type="range" min="1" max="8" value="3" class="w-full">

    <div class="mt-4">
        <label class="block text-purple-900 mb-2">Response Format:</label>
        <div class="flex gap-2">
            <button id="paragraphBtn" class="flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900">
                Paragraph
            </button>
            <button id="caseResponseBtn" class="flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300">
                Evidence Case
            </button>
        </div>
    </div>

    <button id="generateCounterBtn"
        class="w-full mt-4 bg-purple-900 hover:bg-purple-800 text-white font-semibold py-3 rounded">
        Generate Counter-Speech
    </button>
</div>

<div class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl">
    <h2 class="text-xl font-semibold text-purple-900 mb-3">Counter-Speech</h2>
    <div class="bg-white p-4 h-96 rounded overflow-y-auto border-2 border-purple-200">
        <p id="counterOutput" class="text-slate-500 italic">
            Your generated counter-speech will appear here‚Ä¶
        </p>
    </div>
</div>

</div>
</div>

<!-- CASE WRITER -->
<div id="caseSection">
<div class="grid md:grid-cols-2 gap-6">

<div class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl">
    <input id="topic"
        class="w-full p-3 bg-white border-2 border-purple-200 rounded text-slate-900"
        placeholder="Topic / Resolution">

    <div class="flex gap-2 mt-3">
        <button id="affBtn" class="flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900">
            Affirmative
        </button>
        <button id="negBtn" class="flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300">
            Negative
        </button>
    </div>

    <input id="focusPoint1"
        class="w-full mt-3 p-3 bg-white border-2 border-purple-200 rounded text-slate-900"
        placeholder="Focus Point 1 (Required)">

    <div class="flex items-center gap-2 mt-2">
        <label class="text-purple-900 text-sm">Cards:</label>
        <input id="cardsPerPoint1" type="number" min="1" max="10" value="2"
            class="w-16 p-1 bg-white border-2 border-purple-200 rounded text-slate-900 text-center">
    </div>

    <input id="focusPoint2"
        class="w-full mt-3 p-3 bg-white border-2 border-purple-200 rounded text-slate-900"
        placeholder="Focus Point 2 (Optional)">

    <div class="flex items-center gap-2 mt-2">
        <label class="text-purple-900 text-sm">Cards:</label>
        <input id="cardsPerPoint2" type="number" min="1" max="10" value="2"
            class="w-16 p-1 bg-white border-2 border-purple-200 rounded text-slate-900 text-center">
    </div>

    <button id="generateCaseBtn"
        class="w-full mt-4 bg-purple-900 hover:bg-purple-800 py-3 rounded font-semibold text-white">
        Generate Case
    </button>
</div>

<div class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl">
    <h2 class="text-xl font-semibold text-purple-900 mb-3">Generated Case</h2>
    <div class="bg-white p-4 rounded overflow-y-scroll border-2 border-purple-200" style="height: 1000px; max-height: 1000px;">
        <div id="caseOutput" class="text-slate-900">
            <p class="text-slate-500 italic">Your generated case will appear here‚Ä¶</p>
        </div>
    </div>
</div>

</div>
</div>

<!-- DRILLS SECTION -->
<div id="drillsSection" class="hidden">
    <!-- Drill Selection Menu -->
    <div id="drillMenu" class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl max-w-4xl mx-auto">
        <h2 class="text-3xl font-bold text-purple-900 mb-6 text-center">Select a Drill</h2>
        
        <div class="grid gap-4">
            <button id="selectPiratesDrill" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-lg border-2 border-purple-300 text-left transition">
                <h3 class="text-xl font-bold text-purple-900 mb-2">Pirates of Penzance</h3>
                <p class="text-purple-700 italic">(A speaking drill)</p>
                <p class="text-slate-600 mt-2">Practice speed reading with adjustable word-by-word display</p>
            </button>
            
            <button id="selectImpactCalcDrill" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-lg border-2 border-purple-300 text-left transition">
                <h3 class="text-xl font-bold text-purple-900 mb-2">Climate Change vs Bombs</h3>
                <p class="text-purple-700 italic">(An impact calculus drill)</p>
                <p class="text-slate-600 mt-2">Learn to weigh competing impacts using debate frameworks</p>
            </button>
            
            <button id="selectKritikDrill" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-lg border-2 border-purple-300 text-left transition">
                <h3 class="text-xl font-bold text-purple-900 mb-2">Kritik Kreations</h3>
                <p class="text-purple-700 italic">(A Kritik drill)</p>
                <p class="text-slate-600 mt-2">Practice identifying which Kritik best applies to different scenarios</p>
            </button>
            
            <button id="selectTheoryDrill" class="bg-purple-100 hover:bg-purple-200 p-6 rounded-lg border-2 border-purple-300 text-left transition">
                <h3 class="text-xl font-bold text-purple-900 mb-2">Theory Trouble</h3>
                <p class="text-purple-700 italic">(A theory drill)</p>
                <p class="text-slate-600 mt-2">Learn debate theory by categorizing violations</p>
            </button>
        </div>
        
        <button id="backToDrillMenu" class="mt-6 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded hidden">
            ‚Üê Back to Drill Menu
        </button>
    </div>

    <!-- Pirates Drill -->
    <div id="piratesDrill" class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl max-w-4xl mx-auto hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-3xl font-bold text-purple-900">Pirates of Penzance</h2>
            <button id="backFromPirates" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
                ‚Üê Back
            </button>
        </div>
        <p class="text-purple-700 text-center mb-6 italic">(A speaking drill)</p>

        <div class="mb-6">
            <label class="block text-purple-900 font-semibold mb-2">Mode:</label>
            <div class="flex gap-2">
                <button id="presetModeBtn" class="flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900">
                    Preset Poem
                </button>
                <button id="customModeBtn" class="flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300">
                    Custom Text
                </button>
            </div>
        </div>

        <div id="customTextArea" class="hidden mb-6">
            <label class="block text-purple-900 font-semibold mb-2">Enter your text:</label>
            <textarea id="customText" 
                class="w-full p-3 bg-white border-2 border-purple-200 rounded text-slate-900 h-40"
                placeholder="Paste or type your text here..."></textarea>
        </div>

        <div class="mb-6">
            <label class="block text-purple-900 font-semibold mb-2">
                Speed: <span id="speedDisplay">200</span> words per minute
            </label>
            <input id="speedSlider" type="range" min="100" max="400" value="200" step="10" class="w-full">
        </div>

        <div class="flex gap-3 mb-6">
            <button id="startDrillBtn" 
                class="flex-1 bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded">
                Start Drill
            </button>
            <button id="pauseDrillBtn" 
                class="flex-1 bg-gray-400 text-white font-bold py-3 rounded" disabled>
                Pause
            </button>
            <button id="resetDrillBtn" 
                class="flex-1 bg-gray-400 text-white font-bold py-3 rounded" disabled>
                Reset
            </button>
        </div>

        <div class="bg-purple-50 rounded-lg border-2 border-purple-200 p-8">
            <div id="wordDisplay" class="word-display text-purple-900">
                Ready to begin...
            </div>
            <div class="text-center text-purple-700 text-sm mt-4">
                <span id="progressDisplay">Word 0 of 0</span>
            </div>
        </div>
    </div>

    <!-- Impact Calculus Drill -->
    <div id="impactCalcDrill" class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl max-w-4xl mx-auto hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-3xl font-bold text-purple-900">Climate Change vs Bombs</h2>
            <button id="backFromImpact" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
                ‚Üê Back
            </button>
        </div>
        <p class="text-purple-700 text-center mb-6 italic">(An impact calculus drill)</p>

        <div class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-6">
            <div class="text-center mb-4">
                <p class="text-slate-600 text-sm mb-2">Question <span id="questionNumber">1</span> of <span id="totalQuestions">50</span></p>
                <h3 class="text-2xl font-bold text-purple-900 mb-4">Why does</h3>
                <div class="bg-white rounded p-4 mb-2 border-2 border-purple-300">
                    <p id="impact1" class="text-xl font-bold text-purple-900"></p>
                </div>
                <h3 class="text-xl font-semibold text-purple-900 mb-2">outweigh</h3>
                <div class="bg-white rounded p-4 border-2 border-purple-300">
                    <p id="impact2" class="text-xl font-bold text-purple-900"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-6" id="answerButtons">
                <button class="answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Magnitude">
                    Magnitude
                </button>
                <button class="answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Timeframe">
                    Timeframe
                </button>
                <button class="answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Probability">
                    Probability
                </button>
                <button class="answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Reversibility">
                    Reversibility
                </button>
                <button class="answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition md:col-span-2" data-answer="Prerequisite">
                    Prerequisite
                </button>
            </div>
        </div>

        <div id="explanationBox" class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-4 hidden">
            <p id="explanationText" class="text-slate-700 text-lg"></p>
        </div>

        <button id="continueBtn" class="w-full bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded hidden">
            Click to Continue ‚Üí
        </button>

        <div class="mt-4 text-center">
            <p class="text-slate-600">Score: <span id="scoreDisplay" class="font-bold text-purple-900">0</span> / <span id="attemptDisplay">0</span></p>
        </div>
    </div>

    <!-- Kritik Kreations Drill -->
    <div id="kritikDrill" class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl max-w-4xl mx-auto hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-3xl font-bold text-purple-900">Kritik Kreations</h2>
            <button id="backFromKritik" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
                ‚Üê Back
            </button>
        </div>
        <p class="text-purple-700 text-center mb-6 italic">(A Kritik drill)</p>

        <div class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-6">
            <div class="text-center mb-4">
                <p class="text-slate-600 text-sm mb-2">Question <span id="kritikQuestionNumber">1</span> of <span id="kritikTotalQuestions">50</span></p>
                <h3 class="text-2xl font-bold text-purple-900 mb-4">Which Kritik BEST applies?</h3>
                <div class="bg-white rounded p-4 mb-2 border-2 border-purple-300">
                    <p id="affPlan" class="text-lg font-bold text-purple-900"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-3 mt-6" id="kritikAnswerButtons">
                <button class="kritik-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Security K">
                    Security K
                </button>
                <button class="kritik-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Settler Colonialism K">
                    Settler Colonialism K
                </button>
                <button class="kritik-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Capitalist K">
                    Capitalist K
                </button>
            </div>
        </div>

        <div id="kritikExplanationBox" class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-4 hidden">
            <p id="kritikExplanationText" class="text-slate-700 text-lg"></p>
        </div>

        <button id="kritikContinueBtn" class="w-full bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded hidden">
            Click to Continue ‚Üí
        </button>

        <div class="mt-4 text-center">
            <p class="text-slate-600">Score: <span id="kritikScoreDisplay" class="font-bold text-purple-900">0</span> / <span id="kritikAttemptDisplay">0</span></p>
        </div>
    </div>

    <!-- Theory Trouble Drill -->
    <div id="theoryDrill" class="bg-white/95 p-6 rounded-lg border-2 border-purple-300 shadow-xl max-w-4xl mx-auto hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-3xl font-bold text-purple-900">Theory Trouble</h2>
            <button id="backFromTheory" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
                ‚Üê Back
            </button>
        </div>
        <p class="text-purple-700 text-center mb-6 italic">(A theory drill)</p>

        <!-- Category Selection Screen -->
        <div id="theoryCategoryScreen" class="text-center">
            <h3 class="text-2xl font-bold text-purple-900 mb-4">Choose a Theory Category</h3>
            <p class="text-slate-600 mb-6">Select which type of theory violations you'd like to practice</p>
            <div class="flex flex-col gap-4 max-w-md mx-auto">
                <button id="startClashGrounds" class="px-8 py-4 bg-purple-900 hover:bg-purple-800 text-white font-semibold rounded-lg border-2 border-purple-900 transition">
                    Clash / Grounds
                    <p class="text-sm font-normal mt-1">2 answer options ‚Ä¢ 25 questions</p>
                </button>
                <button id="startEduFairAdv" class="px-8 py-4 bg-purple-900 hover:bg-purple-800 text-white font-semibold rounded-lg border-2 border-purple-900 transition">
                    Education / Fairness / Advocacy
                    <p class="text-sm font-normal mt-1">3 answer options ‚Ä¢ 25 questions</p>
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="theoryQuizScreen" class="hidden">
            <div class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-6">
                <div class="text-center mb-4">
                    <p class="text-slate-600 text-sm mb-2">Question <span id="theoryQuestionNumber">1</span> of <span id="theoryTotalQuestions">25</span></p>
                    <p class="text-purple-700 font-semibold mb-4">Category: <span id="theoryCategoryDisplay"></span></p>
                    <h3 class="text-xl font-bold text-purple-900 mb-4">What does this violate?</h3>
                    <div class="bg-white rounded p-6 mb-2 border-2 border-purple-300">
                        <p id="theoryScenario" class="text-base text-slate-700 leading-relaxed text-left"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-3 mt-6" id="theoryAnswerButtons">
                    <!-- Buttons will be dynamically shown based on category -->
                </div>
            </div>

            <div id="theoryExplanationBox" class="bg-purple-50 rounded-lg border-2 border-purple-200 p-6 mb-4 hidden">
                <p id="theoryExplanationText" class="text-slate-700 text-lg"></p>
            </div>

            <button id="theoryContinueBtn" class="w-full bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded hidden">
                Click to Continue ‚Üí
            </button>

            <div class="mt-4 text-center">
                <p class="text-slate-600">Score: <span id="theoryScoreDisplay" class="font-bold text-purple-900">0</span> / <span id="theoryAttemptDisplay">0</span></p>
            </div>
        </div>
    </div>
</div>

</div>

<!-- Footer -->
<footer class="fixed bottom-0 left-0 right-0 bg-purple-900/95 border-t-2 border-purple-900 py-2 text-center">
    <p class="text-white text-sm">HamiltonPro - Advanced Debate Coaching Platform</p>
</footer>

<script>
/* AI CALL */
async function callAI(system, user, maxTokens) {
    const r = await puter.ai.chat(
        [{role:"system",content:system},{role:"user",content:user}],
        {model:"claude-sonnet-4-20250514",temperature:0.7,max_tokens:maxTokens}
    );
    return r.message.content.map(b=>b.text).join('\n');
}

/* PIRATES OF PENZANCE POEM */
const poemStanzas = [
    "I am the very model of a modern Major-Gineral, I've information vegetable, animal, and mineral, I know the kings of England, and I quote the fights historical From Marathon to Waterloo, in order categorical; I'm very well acquainted, too, with matters mathematical, I understand equations, both the simple and quadratical, About binomial theorem I'm teeming with a lot o' news, With many cheerful facts about the square of the hypotenuse.",
    "I'm very good at integral and differential calculus; I know the scientific names of beings animalculous: In short, in matters vegetable, animal, and mineral, I am the very model of a modern Major-Gineral.",
    "I know our mythic history, King Arthur's and Sir Caradoc's; I answer hard acrostics, I've a pretty taste for paradox, I quote in elegiacs all the crimes of Heliogabalus, In conics I can floor peculiarities parabolous; I can tell undoubted Raphaels from Gerard Dows and Zoffanies, I know the croaking chorus from The Frogs of Aristophanes! Then I can hum a fugue of which I've heard the music's din afore, And whistle all the airs from that infernal nonsense Pinafore.",
    "Then I can write a washing bill in Babylonic cuneiform, And tell you ev'ry detail of Caractacus's uniform: In short, in matters vegetable, animal, and mineral, I am the very model of a modern Major-Gineral.",
    "In fact, when I know what is meant by \"mamelon\" and \"ravelin\", When I can tell at sight a Mauser rifle from a javelin, When such affairs as sorties and surprises I'm more wary at, And when I know precisely what is meant by \"commissariat\", When I have learnt what progress has been made in modern gunnery, When I know more of tactics than a novice in a nunnery ‚Äì In short, when I've a smattering of elemental strategy ‚Äì You'll say a better Major-General has never sat a gee.",
    "For my military knowledge, though I'm plucky and adventury, Has only been brought down to the beginning of the century; But still, in matters vegetable, animal, and mineral, I am the very model of a modern Major-Gineral."
];

/* DRILL STATE */
let drillMode = 'preset';
let drillWords = [];
let currentWordIndex = 0;
let drillInterval = null;
let drillPaused = false;
let wordsPerMinute = 200;

/* DOCX EXPORT */
function exportCaseToDocx(html, topic) {
    const {Document, Paragraph, TextRun, Packer, PageBreak} = docx;
    const safeName = topic.trim().replace(/[^a-z0-9]+/gi,"_").toLowerCase();
    const temp = document.createElement("div");
    temp.innerHTML = html;
    const children = [];
    let currentContention = null;

    temp.querySelectorAll(".debate-card").forEach((card, index) => {
        const tag = card.querySelector(".tag")?.innerText || "";
        if (tag !== currentContention) {
            if (index !== 0) {
                children.push(new Paragraph(""));
                children.push(new Paragraph({children:[new PageBreak()]}));
                children.push(new Paragraph(""));
            }
            currentContention = tag;
        }
        children.push(new Paragraph({children:[new TextRun({text:tag,bold:true,size:24})],spacing:{after:200}}));

        const cite = card.querySelector(".cite");
        if (cite) {
            const fullText = cite.innerText;
            const match = fullText.match(/^(.+?'\d{2})/);
            if (match) {
                children.push(new Paragraph({children:[
                    new TextRun({text:match[1],bold:true,italics:true}),
                    new TextRun({text:fullText.substring(match[1].length),italics:true})
                ],spacing:{after:200}}));
            } else {
                children.push(new Paragraph({children:[
                    new TextRun({text:fullText,italics:true})
                ],spacing:{after:200}}));
            }
        }

        const cardText = card.querySelector(".card-text");
        if (cardText) {
            const runs = [];
            const processNode = (n, inherited = {}) => {
                if (n.nodeType === Node.TEXT_NODE) {
                    const txt = n.textContent;
                    if (txt.trim()) {
                        runs.push(new TextRun({
                            text:txt,
                            bold:inherited.bold,
                            underline:inherited.underline?{}:undefined,
                            highlight:inherited.highlight?"cyan":undefined
                        }));
                    }
                } else if (n.nodeType === Node.ELEMENT_NODE) {
                    const isStrong = n.tagName==="STRONG" || inherited.bold;
                    const isUnderline = n.tagName==="U" || inherited.underline;
                    const isMark = n.tagName==="MARK" || inherited.highlight;
                    
                    if (n.childNodes.length > 0) {
                        n.childNodes.forEach(child => {
                            processNode(child, {
                                bold:isStrong,
                                underline:isUnderline,
                                highlight:isMark
                            });
                        });
                    } else {
                        const txt = n.textContent;
                        if (txt.trim()) {
                            runs.push(new TextRun({
                                text:txt,
                                bold:isStrong,
                                underline:isUnderline?{}:undefined,
                                highlight:isMark?"cyan":undefined
                            }));
                        }
                    }
                }
            };
            
            cardText.childNodes.forEach(node => processNode(node));
            if (runs.length>0) children.push(new Paragraph({children:runs}));
        }
        children.push(new Paragraph(""));
    });

    const doc = new Document({sections:[{children}]});
    Packer.toBlob(doc).then(blob => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = safeName+"-hamiltonPro.docx";
        a.click();
        URL.revokeObjectURL(a.href);
    });
}
window.exportCaseToDocx = exportCaseToDocx;

/* TAB LOGIC */
document.getElementById('counterTab').onclick = () => {
    document.getElementById('counterSection').classList.remove("hidden");
    document.getElementById('caseSection').classList.add("hidden");
    document.getElementById('drillsSection').classList.add("hidden");
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-purple-900 text-white font-semibold border-2 border-purple-900";
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
    document.getElementById('drillsTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
};

document.getElementById('caseTab').onclick = () => {
    document.getElementById('caseSection').classList.remove("hidden");
    document.getElementById('counterSection').classList.add("hidden");
    document.getElementById('drillsSection').classList.add("hidden");
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-purple-900 text-white font-semibold border-2 border-purple-900";
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
    document.getElementById('drillsTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
};

document.getElementById('drillsTab').onclick = () => {
    document.getElementById('drillsSection').classList.remove("hidden");
    document.getElementById('counterSection').classList.add("hidden");
    document.getElementById('caseSection').classList.add("hidden");
    document.getElementById('drillsTab').className = "px-6 py-3 rounded bg-purple-900 text-white font-semibold border-2 border-purple-900";
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-white/90 text-purple-900 font-semibold border-2 border-purple-300";
};

/* COUNTER SPEECH */
let responseFormat = "paragraph";

document.getElementById('paragraphBtn').onclick = () => {
    responseFormat = "paragraph";
    document.getElementById('paragraphBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('caseResponseBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
};

document.getElementById('caseResponseBtn').onclick = () => {
    responseFormat = "case";
    document.getElementById('caseResponseBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('paragraphBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
};

document.getElementById('speechLength').oninput = e =>
    document.getElementById('speechLengthDisplay').textContent = e.target.value;

document.getElementById('generateCounterBtn').onclick = async () => {
    const counterOutput = document.getElementById('counterOutput');
    const caseInput = document.getElementById('caseInput');
    const speechLength = document.getElementById('speechLength');
    
    if (!caseInput.innerText.trim()) {
        counterOutput.textContent = "Please paste a case first!";
        counterOutput.className = "text-red-400";
        return;
    }
    
    counterOutput.textContent = "Generating‚Ä¶";
    counterOutput.className = "text-slate-400 italic";

    const prompt = responseFormat === "paragraph"
        ? "Generate a "+speechLength.value+"-minute rebuttal speech against:\n\n"+caseInput.innerText+"\n\nBe structured, analytical, and persuasive."
        : "Generate a counter-case with evidence cards refuting:\n\n"+caseInput.innerText+"\n\nUse proper HTML formatting with debate-card class, highlighting, and [Cut by Hamilton Debate-LQ] tags.";

    try {
        const text = await callAI(
            responseFormat==="paragraph"?"You are a high-level debate coach.":"You are an expert debate case writer.",
            prompt,
            responseFormat==="paragraph"?parseInt(speechLength.value)*180:2000
        );
        if (responseFormat==="case") {
            counterOutput.innerHTML = text;
            counterOutput.className = "text-slate-900";
        } else {
            counterOutput.innerText = text;
            counterOutput.className = "text-slate-900";
        }
    } catch (err) {
        counterOutput.innerText = "Error: "+err.message;
        counterOutput.className = "text-red-400";
    }
};

/* CASE GENERATOR */
let side = "Aff";

document.getElementById('affBtn').onclick = () => {
    side = "Aff";
    document.getElementById('affBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('negBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
};

document.getElementById('negBtn').onclick = () => {
    side = "Neg";
    document.getElementById('negBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('affBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
};

document.getElementById('generateCaseBtn').onclick = async () => {
    const caseOutput = document.getElementById('caseOutput');
    const topic = document.getElementById('topic');
    const focusPoint1 = document.getElementById('focusPoint1');
    const focusPoint2 = document.getElementById('focusPoint2');
    const cardsPerPoint1 = document.getElementById('cardsPerPoint1');
    const cardsPerPoint2 = document.getElementById('cardsPerPoint2');
    
    if (!topic.value.trim()) {
        caseOutput.innerHTML = "<p class='text-red-500'>Please enter a topic!</p>";
        return;
    }
    if (!focusPoint1.value.trim()) {
        caseOutput.innerHTML = "<p class='text-red-500'>Please enter at least one focus point!</p>";
        return;
    }
    
    const debateFacts = [
        "The NSDA was founded in Wisconsin to motivate high school students in speech and debate activities.",
        "The NSDA was originally known as the National Forensic League (NFL); the name was changed to the NSDA in 2014.",
        "The NSDA is the largest interscholastic speech and debate organization with over 140,000 student members.",
        "Famous NSDA alumni include Supreme Court Justices, Oprah Winfrey, Brad Pitt, and Stephen Colbert.",
        "The annual NSDA National Tournament has been held continuously since 1931, except during World War II.",
        "NSDA honor society students often fall into the top 5% of their classes."
    ];
    
    const randomFact = debateFacts[Math.floor(Math.random() * debateFacts.length)];
    caseOutput.innerHTML = "<p class='text-slate-700'><strong>üîÑ Loading... Fun Fact:</strong> " + randomFact + "</p>";

    const focusPoints = [];
    if (focusPoint1.value.trim()) {
        focusPoints.push({point:focusPoint1.value.trim(),cards:parseInt(cardsPerPoint1.value)||2});
    }
    if (focusPoint2.value.trim()) {
        focusPoints.push({point:focusPoint2.value.trim(),cards:parseInt(cardsPerPoint2.value)||2});
    }

    const totalCards = focusPoints.reduce((sum,fp)=>sum+fp.cards,0);
    const prompt = "Write a "+side+" debate case on: "+topic.value+"\n\nCreate EXACTLY "+totalCards+" UNIQUE evidence cards total (NO DUPLICATES). Each card MUST have a different argument and different source.\n\nFocus Points:\n"+focusPoints.map((fp,i)=>(i+1)+". "+fp.point+" ("+fp.cards+" unique cards with DIFFERENT sources)").join("\n")+"\n\nCRITICAL: You must generate EXACTLY "+totalCards+" cards - no more, no less. Each must be complete and unique.\n\nIMPORTANT FORMATTING RULES:\n- DO NOT include any text before or after the debate cards\n- DO NOT include explanations, introductions, or commentary\n- DO NOT repeat any sources, authors, or arguments\n- Each card must be wrapped ONLY in <div class='debate-card'>...</div>\n- NO text outside these divs\n\nFor each card:\n- Include a clear tag line wrapped in <div class='tag'>TAG HERE</div>\n- Include FULL citation wrapped in <div class='cite'>CITATION HERE [Cut by Hamilton Debate-LQ]</div> with author name, year, credentials/publication, article title, URL, and ending with [Cut by Hamilton Debate-LQ]\n- Include evidence text wrapped in <div class='card-text'>EVIDENCE HERE</div> (NO [Cut by Hamilton Debate-LQ] here)\n- Use <mark> tags for highlighting key phrases (NOT ** symbols)\n- Use <strong> tags for bold text  \n- Use <u> tags for underlined text\n\nExample format:\n<div class='debate-card'>\n  <div class='tag'>Nuclear accidents cause catastrophic long-term contamination</div>\n  <div class='cite'>Steinberg '21 (Mark Steinberg, Nuclear Safety Engineer) \"Fukushima's Lasting Legacy\" Nuclear Safety Quarterly https://www.example.com [Cut by Hamilton Debate-LQ]</div>\n  <div class='card-text'>The <mark><strong>Fukushima disaster demonstrates that nuclear accidents create contamination zones lasting centuries</strong></mark>. Even ten years after the meltdown, <u>radiation levels in the exclusion zone remain dangerously high</u>, forcing permanent evacuation of entire communities.</div>\n</div>\n\nVerify: Output EXACTLY "+totalCards+" complete debate-card divs with ABSOLUTELY NO extra text before, after, or between cards.";

    try {
        let attemptCount = 0;
        let uniqueCards = [];
        
        while (attemptCount < 3 && uniqueCards.length !== totalCards) {
            attemptCount++;
            console.log("Attempt", attemptCount, "- Requesting", totalCards, "cards");
            
            const html = await callAI("You are an expert debate case writer. Create unique, non-duplicate evidence cards with complete citations including URLs. Output ONLY the debate-card HTML divs with ABSOLUTELY NO additional text, commentary, or explanations before, after, or between cards.",prompt,4000);
            
            const temp = document.createElement("div");
            temp.innerHTML = html;
            
            // AGGRESSIVE CLEANUP: Remove ALL non-debate-card elements
            const allChildren = Array.from(temp.children);
            allChildren.forEach(child => {
                if (!child.classList || !child.classList.contains('debate-card')) {
                    console.log("Removing non-card element:", child.tagName, child.textContent.substring(0, 50));
                    child.remove();
                }
            });
            
            // Also remove any stray text nodes
            const walker = document.createTreeWalker(temp, NodeFilter.SHOW_TEXT, null, false);
            const textNodesToRemove = [];
            while (walker.nextNode()) {
                if (walker.currentNode.parentNode === temp && walker.currentNode.textContent.trim()) {
                    textNodesToRemove.push(walker.currentNode);
                }
            }
            textNodesToRemove.forEach(node => {
                console.log("Removing stray text:", node.textContent.substring(0, 50));
                node.remove();
            });
            
            const cards = temp.querySelectorAll(".debate-card");
            uniqueCards = [];
            const seenAuthors = new Set();
            const seenTags = new Set();
            
            console.log("Raw cards found:", cards.length);
            
            cards.forEach((card, idx) => {
                const tag = card.querySelector(".tag")?.innerText || "";
                const cite = card.querySelector(".cite")?.innerText || "";
                const cardText = card.querySelector(".card-text")?.innerText || "";
                
                // Validate card structure
                if (!tag.trim() || !cite.trim() || !cardText.trim()) {
                    console.log("Skipped card", idx+1, "- missing required content");
                    return;
                }
                
                // Check for valid HTML structure
                if (!card.querySelector(".tag") || !card.querySelector(".cite") || !card.querySelector(".card-text")) {
                    console.log("Skipped card", idx+1, "- invalid HTML structure");
                    return;
                }
                
                const authorMatch = cite.match(/^([^']+)'(\d{2})/);
                const authorName = authorMatch ? authorMatch[1].trim().toLowerCase() : "";
                const tagLower = tag.toLowerCase().trim();
                
                if (seenAuthors.has(authorName) || seenTags.has(tagLower)) {
                    console.log("Skipped duplicate card", idx+1, "- Author:", authorName);
                    return;
                }
                
                seenAuthors.add(authorName);
                seenTags.add(tagLower);
                uniqueCards.push(card);
                console.log("Added card", idx+1, "- Author:", authorName);
            });
            
            console.log("Attempt", attemptCount, "- Got", uniqueCards.length, "unique cards, needed", totalCards);
            
            if (uniqueCards.length === totalCards) {
                console.log("‚úì Success! Got exactly", totalCards, "cards");
                break;
            }
        }
        
        if (uniqueCards.length !== totalCards) {
            console.warn("Warning: Requested", totalCards, "cards but got", uniqueCards.length, "unique cards after 3 attempts");
        }
        
        const rebuiltHtml = uniqueCards.map(c=>c.outerHTML).join("");

        if (uniqueCards.length>0) {
            const escapedHtml = rebuiltHtml.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
            const escapedTopic = topic.value.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
            
            const cardCountMsg = uniqueCards.length === totalCards 
                ? `<p class="text-green-600 mb-3">‚úì Generated exactly ${totalCards} unique cards as requested</p>`
                : `<p class="text-amber-600 mb-3">‚ö† Generated ${uniqueCards.length} of ${totalCards} requested cards (duplicates removed)</p>`;
            
            if (uniqueCards.length>15) {
                caseOutput.innerHTML = cardCountMsg + Array.from(uniqueCards).slice(0,15).map(c=>c.outerHTML).join("")+
                    '<div class="mt-6 text-center">'+
                    '<p class="text-slate-700 mb-3">Showing 15 of '+uniqueCards.length+' cards</p>'+
                    '<button class="bg-purple-900 text-white px-6 py-3 rounded font-semibold hover:bg-purple-800" '+
                    'onclick="exportCaseToDocx(\''+escapedHtml+'\',\''+escapedTopic+'\'); this.textContent=\'Downloaded!\'; this.disabled=true;">'+
                    'Download Full Case (.docx)</button></div>';
            } else {
                caseOutput.innerHTML = cardCountMsg + rebuiltHtml+
                    '<div class="mt-6 text-center">'+
                    '<button class="bg-purple-900 text-white px-6 py-3 rounded font-semibold hover:bg-purple-800" '+
                    'onclick="exportCaseToDocx(\''+escapedHtml+'\',\''+escapedTopic+'\'); this.textContent=\'Downloaded!\'; this.disabled=true;">'+
                    'Download Case (.docx)</button></div>';
            }
        } else {
            caseOutput.innerHTML = html;
        }
        caseOutput.className = "text-slate-900";
    } catch (err) {
        caseOutput.innerHTML = "<p class='text-red-500'>Error: "+err.message+"</p>";
    }
};

/* DRILL MODE BUTTONS */
document.getElementById('presetModeBtn').onclick = () => {
    drillMode = 'preset';
    document.getElementById('presetModeBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('customModeBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
    document.getElementById('customTextArea').classList.add('hidden');
};

document.getElementById('customModeBtn').onclick = () => {
    drillMode = 'custom';
    document.getElementById('customModeBtn').className = "flex-1 bg-purple-900 py-2 rounded font-semibold text-white border-2 border-purple-900";
    document.getElementById('presetModeBtn').className = "flex-1 bg-white py-2 rounded text-purple-900 border-2 border-purple-300";
    document.getElementById('customTextArea').classList.remove('hidden');
};

document.getElementById('speedSlider').oninput = (e) => {
    wordsPerMinute = parseInt(e.target.value);
    document.getElementById('speedDisplay').textContent = wordsPerMinute;
};

function getRandomStanzas() {
    const shuffled = [...poemStanzas].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 2).join(' ');
}

function prepareWords() {
    let text;
    if (drillMode === 'preset') {
        text = getRandomStanzas();
    } else {
        text = document.getElementById('customText').value.trim();
        if (!text) {
            alert('Please enter some text for the custom drill!');
            return false;
        }
    }
    drillWords = text.split(/\s+/).filter(w => w.length > 0);
    currentWordIndex = 0;
    return true;
}

function resetDrillButtons() {
    document.getElementById('startDrillBtn').disabled = false;
    document.getElementById('startDrillBtn').textContent = "Start Drill";
    document.getElementById('startDrillBtn').className = "flex-1 bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded";
    document.getElementById('pauseDrillBtn').disabled = true;
    document.getElementById('pauseDrillBtn').className = "flex-1 bg-gray-400 text-white font-bold py-3 rounded";
    document.getElementById('resetDrillBtn').disabled = true;
    document.getElementById('resetDrillBtn').className = "flex-1 bg-gray-400 text-white font-bold py-3 rounded";
}

function displayWord() {
    if (currentWordIndex < drillWords.length) {
        document.getElementById('wordDisplay').textContent = drillWords[currentWordIndex];
        document.getElementById('progressDisplay').textContent = 
            `Word ${currentWordIndex + 1} of ${drillWords.length}`;
        currentWordIndex++;
    } else {
        stopDrill();
        document.getElementById('wordDisplay').textContent = "Complete! üéâ";
        resetDrillButtons();
    }
}

function startDrill() {
    if (drillInterval) return;
    
    if (currentWordIndex === 0) {
        if (!prepareWords()) return;
    }
    
    drillPaused = false;
    const msPerWord = (60 / wordsPerMinute) * 1000;
    
    displayWord();
    drillInterval = setInterval(displayWord, msPerWord);
    
    document.getElementById('startDrillBtn').disabled = true;
    document.getElementById('startDrillBtn').className = "flex-1 bg-gray-400 text-white font-bold py-3 rounded";
    document.getElementById('pauseDrillBtn').disabled = false;
    document.getElementById('pauseDrillBtn').className = "flex-1 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded";
    document.getElementById('resetDrillBtn').disabled = false;
    document.getElementById('resetDrillBtn').className = "flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded";
}

function pauseDrill() {
    if (drillInterval) {
        clearInterval(drillInterval);
        drillInterval = null;
        drillPaused = true;
        
        document.getElementById('startDrillBtn').disabled = false;
        document.getElementById('startDrillBtn').textContent = "Resume";
        document.getElementById('startDrillBtn').className = "flex-1 bg-purple-900 hover:bg-purple-800 text-white font-bold py-3 rounded";
    }
}

function stopDrill() {
    if (drillInterval) {
        clearInterval(drillInterval);
        drillInterval = null;
    }
}

function resetDrill() {
    stopDrill();
    currentWordIndex = 0;
    drillWords = [];
    drillPaused = false;
    document.getElementById('wordDisplay').textContent = "Ready to begin...";
    document.getElementById('progressDisplay').textContent = "Word 0 of 0";
    
    resetDrillButtons();
}

document.getElementById('startDrillBtn').onclick = startDrill;
document.getElementById('pauseDrillBtn').onclick = pauseDrill;
document.getElementById('resetDrillBtn').onclick = resetDrill;

/* IMPACT CALCULUS DRILL DATA */
const impactCalcScenarios = [
    {impact1:"Nuclear War",impact2:"Economic Recession",correct:"Magnitude",explanation:"Nuclear war outweighs on Magnitude because it is an existential threat that ends all life."},
    {impact1:"Global Pandemic",impact2:"Healthcare Costs",correct:"Magnitude",explanation:"Pandemic outweighs on Magnitude because it affects the global population simultaneously."},
    {impact1:"Total Economic Collapse",impact2:"Tax Hikes",correct:"Magnitude",explanation:"Collapse outweighs on Magnitude because it leads to systemic violence and starvation."},
    {impact1:"AI Extinction",impact2:"Job Automation",correct:"Reversibility",explanation:"Extinction outweighs on Reversibility; you can retrain workers, but you cannot bring back the human race."},
    {impact1:"Climate Tipping Points",impact2:"Gas Prices",correct:"Timeframe",explanation:"Climate outweighs on Timeframe (long-term survival) and Magnitude."},
    {impact1:"Asteroid Impact",impact2:"Space Program Budget",correct:"Magnitude",explanation:"Asteroid outweighs on Magnitude because it is a 'terminal' impact."},
    {impact1:"Mass Starvation",impact2:"Food Inflation",correct:"Magnitude",explanation:"Starvation outweighs on Magnitude because death is an irreversible outcome."},
    {impact1:"Super-volcano Eruption",impact2:"Air Quality Standards",correct:"Magnitude",explanation:"Eruption outweighs on Magnitude as it threatens the entire biosphere."},
    {impact1:"Totalitarian Takeover",impact2:"Privacy Infringement",correct:"Magnitude",explanation:"Totalitarianism outweighs on Scope because it removes all rights, not just one."},
    {impact1:"Resource Wars",impact2:"Trade Tariffs",correct:"Magnitude",explanation:"Wars outweigh on Magnitude due to the direct loss of life."},
    {impact1:"Chronic Poverty",impact2:"Sudden Revolution",correct:"Probability",explanation:"Poverty outweighs on Probability because people are suffering now, whereas a revolution is speculative."},
    {impact1:"Daily Car Accidents",impact2:"Commercial Plane Crashes",correct:"Probability",explanation:"Accidents outweigh on Probability because the statistical death toll is higher annually."},
    {impact1:"Education Inequality",impact2:"Future Tech Singularity",correct:"Probability",explanation:"Inequality outweighs on Probability because it is a verified, ongoing crisis."},
    {impact1:"Mental Health Crisis",impact2:"Cyber-Warfare",correct:"Probability",explanation:"Mental health outweighs on Probability because the evidence of harm is already visible in the data."},
    {impact1:"Malaria Deaths",impact2:"Bioterrorism",correct:"Probability",explanation:"Malaria outweighs on Probability because it kills millions every year, while bioterrorism is a potential risk."},
    {impact1:"Homelessness",impact2:"Housing Market Crash",correct:"Probability",explanation:"Homelessness outweighs on Magnitude (Individual) and Probability because the harm is currently occurring."},
    {impact1:"Infrastructure Decay",impact2:"Alien First Contact",correct:"Probability",explanation:"Infrastructure outweighs on Probability (certainty)."},
    {impact1:"Domestic Abuse",impact2:"Foreign Espionage",correct:"Probability",explanation:"Domestic abuse outweighs on Probability and directness of harm."},
    {impact1:"Lead Poisoning",impact2:"Future Genetic Engineering Risks",correct:"Probability",explanation:"Lead outweighs on Probability because the damage to children is already documented."},
    {impact1:"Deforestation",impact2:"Theoretical Ecosystem Shifts",correct:"Probability",explanation:"Deforestation outweighs on Probability because the damage is currently observable."},
    {impact1:"Institutional Racism",impact2:"A Single Riot",correct:"Magnitude",explanation:"Racism outweighs on Scope and Magnitude because it affects millions over centuries."},
    {impact1:"Gender Pay Gap",impact2:"A Brief Strike",correct:"Timeframe",explanation:"Pay gap outweighs on Timeframe because the cumulative harm spans lifetimes."},
    {impact1:"Lack of Clean Water",impact2:"A Water Utility Hack",correct:"Magnitude",explanation:"Lack of water outweighs on Scope as it affects billions globally every day."},
    {impact1:"Illiteracy",impact2:"School Voucher Debate",correct:"Magnitude",explanation:"Illiteracy outweighs on Magnitude because it creates a 'cycle of poverty' that is harder to reverse."},
    {impact1:"Species Extinction",impact2:"Local Poaching Incident",correct:"Reversibility",explanation:"Extinction outweighs on Reversibility; once a species is gone, it is gone forever."},
    {impact1:"Drug Addiction Epidemic",impact2:"One Cartel Bust",correct:"Magnitude",explanation:"Epidemic outweighs on Scope because it is a systemic public health crisis."},
    {impact1:"Microplastic Pollution",impact2:"A Single Oil Spill",correct:"Magnitude",explanation:"Microplastics outweigh on Scope because they are in every ocean and organism."},
    {impact1:"Aging Population",impact2:"Short-term Labor Shortage",correct:"Timeframe",explanation:"Aging outweighs on Timeframe because it is a permanent demographic shift."},
    {impact1:"Erosion of Democracy",impact2:"One Bad Election",correct:"Reversibility",explanation:"Erosion outweighs on Reversibility because it destroys the system itself."},
    {impact1:"Loss of Indigenous Languages",impact2:"A Museum Closing",correct:"Magnitude",explanation:"Language loss outweighs on Magnitude because it is the loss of an entire culture's knowledge."},
    {impact1:"Economic Stability",impact2:"Environmental Regulation",correct:"Prerequisite",explanation:"Economy outweighs as a Prerequisite; you need money to fund green energy."},
    {impact1:"Energy Security",impact2:"Carbon Neutrality",correct:"Prerequisite",explanation:"Energy outweighs as a Prerequisite; if the grid fails, society collapses before we can fix the climate."},
    {impact1:"Quality Education",impact2:"Workforce Productivity",correct:"Prerequisite",explanation:"Education outweighs as a Prerequisite for a functioning economy."},
    {impact1:"Political Stability",impact2:"International Aid",correct:"Prerequisite",explanation:"Stability outweighs as a Prerequisite; you cannot deliver aid in a permanent war zone."},
    {impact1:"Basic Nutrition",impact2:"Brain Development",correct:"Prerequisite",explanation:"Nutrition outweighs as a Prerequisite; children cannot learn if they are starving."},
    {impact1:"Peace",impact2:"Human Rights",correct:"Prerequisite",explanation:"Peace outweighs as a Prerequisite; rights are usually the first thing suspended during a war."},
    {impact1:"Public Trust",impact2:"Vaccine Distribution",correct:"Prerequisite",explanation:"Trust outweighs as a Prerequisite; the medicine doesn't work if no one takes it."},
    {impact1:"Grid Resilience",impact2:"Electric Vehicle Transition",correct:"Prerequisite",explanation:"Resilience outweighs as a Prerequisite; EVs need a working plug."},
    {impact1:"Freedom of Speech",impact2:"Scientific Progress",correct:"Prerequisite",explanation:"Speech outweighs as a Prerequisite because science requires the ability to challenge old ideas."},
    {impact1:"Cybersecurity",impact2:"Digital Banking",correct:"Prerequisite",explanation:"Security outweighs as a Prerequisite; the system cannot exist if people's money is not safe."},
    {impact1:"Death",impact2:"Temporary Incarceration",correct:"Reversibility",explanation:"Death outweighs on Reversibility."},
    {impact1:"Permanent Brain Damage",impact2:"Broken Bones",correct:"Reversibility",explanation:"Brain damage outweighs on Reversibility."},
    {impact1:"Soil Depletion",impact2:"Crop Failure",correct:"Timeframe",explanation:"Depletion outweighs on Timeframe because it takes centuries to rebuild topsoil."},
    {impact1:"Short-term Inflation",impact2:"Long-term Debt",correct:"Timeframe",explanation:"Debt outweighs on Timeframe because it burdens future generations."},
    {impact1:"Immediate Famine",impact2:"Future Obesity Trends",correct:"Timeframe",explanation:"Famine outweighs on Timeframe (happens now) and Magnitude."},
    {impact1:"Nuclear Waste",impact2:"Chemical Waste",correct:"Timeframe",explanation:"Nuclear outweighs on Timeframe because it remains dangerous for thousands of years."},
    {impact1:"Mental Trauma",impact2:"Physical Bruising",correct:"Reversibility",explanation:"Trauma outweighs on Reversibility and Timeframe as it can last a lifetime."},
    {impact1:"Glacial Melt",impact2:"Seasonal Flooding",correct:"Reversibility",explanation:"Glacial melt outweighs on Reversibility (ice won't return for ages)."},
    {impact1:"Loss of Privacy",impact2:"Higher Ad Costs",correct:"Reversibility",explanation:"Privacy outweighs on Reversibility; once data is leaked, it cannot be 'un-leaked.'"},
    {impact1:"Genetic Mutation",impact2:"Seasonal Illness",correct:"Reversibility",explanation:"Mutation outweighs on Magnitude and Reversibility because it affects the lineage."}
];

let currentQuestionIndex = 0;
let score = 0;
let attempts = 0;

/* KRITIK DRILL DATA */
const kritikScenarios = [
    {aff:"Increased Border Patrol",correct:"Security K",explanation:"Security K outweighs because framing migrants as a 'threat' creates a cycle of state violence that makes everyone less safe."},
    {aff:"Green Energy Subsidies",correct:"Capitalist K",explanation:"Cap K outweighs because subsidizing corporations ignores the root cause of climate change: infinite growth on a finite planet."},
    {aff:"Expanding National Parks",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because 'wilderness' framing erases Indigenous history and reinforces the state's stolen claim to the land."},
    {aff:"Missile Defense Systems",correct:"Security K",explanation:"Security K outweighs because the 'security dilemma' ensures an arms race, making nuclear war more likely, not less."},
    {aff:"Universal Basic Income",correct:"Capitalist K",explanation:"Cap K outweighs because UBI is a 'bandage' that preserves the capitalist system by preventing the working class from revolting."},
    {aff:"High-Speed Rail on Public Land",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because building infrastructure on unceded territory is a continuation of colonial expansion."},
    {aff:"Cyber-Warfare Protection",correct:"Security K",explanation:"Security K outweighs because it expands the 'theatre of war' into every aspect of digital life, creating a state of permanent fear."},
    {aff:"Carbon Tax Credits",correct:"Capitalist K",explanation:"Cap K outweighs because 'market-based solutions' treat the Earth as a commodity, which is the logic that caused the crisis."},
    {aff:"Affordable Housing Projects",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because it reinforces the Western concept of 'property ownership' over Indigenous models of land relation."},
    {aff:"Bioterrorism Surveillance",correct:"Security K",explanation:"Security K outweighs because 'pre-emptive' surveillance justifies the racial profiling of scientists and travelers."},
    {aff:"Micro-loans for Small Businesses",correct:"Capitalist K",explanation:"Cap K outweighs because it forces the global poor into debt cycles and individualizes systemic poverty."},
    {aff:"Pipeline Safety Regulations",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because 'regulating' a pipeline still assumes the state has the right to put a pipe through Indigenous land."},
    {aff:"AI Drone Technology for Defense",correct:"Security K",explanation:"Security K outweighs because it dehumanizes warfare, making the decision to kill mathematically 'easier' and more frequent."},
    {aff:"Privatizing Space Exploration",correct:"Capitalist K",explanation:"Cap K outweighs because it extends the exploitation of labor and resources into the 'final frontier.'"},
    {aff:"Federal Land Management",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because the 'Managerial' state logic assumes Indigenous people are incapable of self-governance."},
    {aff:"Counter-Terrorism Funding",correct:"Security K",explanation:"Security K outweighs because it relies on 'Othering' specific cultures to justify a permanent state of emergency."},
    {aff:"Job Training Programs",correct:"Capitalist K",explanation:"Cap K outweighs because it treats humans as 'human capital' whose only value is their productivity for the ruling class."},
    {aff:"Scientific Research in the Arctic",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because Western science often ignores Traditional Ecological Knowledge (TEK) and treats the Arctic as an empty laboratory."},
    {aff:"Biometric ID Cards",correct:"Security K",explanation:"Security K outweighs because it turns the human body into a trackable 'barcode' for the state."},
    {aff:"Free Trade Agreements",correct:"Capitalist K",explanation:"Cap K outweighs because these agreements prioritize corporate profits over labor rights and local environmental protections."},
    {aff:"Disaster Relief Aid",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because state-led aid often bypasses Tribal sovereignty, making tribes dependent on their colonizer."},
    {aff:"Maritime Security in the South China Sea",correct:"Security K",explanation:"Security K outweighs because 'freedom of navigation' is a mask for maintaining global military hegemony."},
    {aff:"Public-Private Partnerships for Schools",correct:"Capitalist K",explanation:"Cap K outweighs because it turns education into a profit-generating tool for investors."},
    {aff:"Clean Water Act Updates",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because the US legal framework refuses to recognize 'Rights of Nature' common in Indigenous legalities."},
    {aff:"Strengthening NATO",correct:"Security K",explanation:"Security K outweighs because military blocs create a 'us vs. them' mentality that prevents global cooperation."},
    {aff:"Automation of Manufacturing",correct:"Capitalist K",explanation:"Cap K outweighs because under capitalism, automation leads to poverty, whereas under a different system it could lead to liberation."},
    {aff:"Decarbonizing the Military",correct:"Security K",explanation:"Security K outweighs because a 'green' military is still a machine used for killing and global dominance."},
    {aff:"Intellectual Property Rights for Vaccines",correct:"Capitalist K",explanation:"Cap K outweighs because putting a price on life-saving medicine is the ultimate 'death-logic' of capital."},
    {aff:"Repurposing Military Bases for Housing",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because the land should be returned (Land Back) rather than repurposed by the occupier."},
    {aff:"Early Warning Systems for War",correct:"Security K",explanation:"Security K outweighs because it assumes war is 'inevitable,' which becomes a self-fulfilling prophecy."},
    {aff:"Economic Sanctions to Stop War",correct:"Capitalist K",explanation:"Cap K outweighs because sanctions hurt the working class while the elites remains unaffected."},
    {aff:"Promoting 'Democracy' Abroad",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because it imposes a Western liberal model on cultures with their own traditional forms of consensus."},
    {aff:"Satellites for Global Internet",correct:"Security K",explanation:"Security K outweighs because it provides the infrastructure for 'Total Information Awareness' and global spying."},
    {aff:"Debt Relief for Developing Nations",correct:"Capitalist K",explanation:"Cap K outweighs because the 'relief' usually comes with requirements to privatize national resources."},
    {aff:"Establishing New National Monuments",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because it uses the 'Antiquities Act'‚Äîa colonial law‚Äîto claim power over land."},
    {aff:"Expanding Nuclear Power",correct:"Security K",explanation:"Security K outweighs because the 'plutonium economy' requires extreme policing and state secrecy to protect."},
    {aff:"Corporate Social Responsibility",correct:"Capitalist K",explanation:"Cap K outweighs because it is 'greenwashing' meant to prevent real systemic change."},
    {aff:"Federal Funding for Police Body Cams",correct:"Security K",explanation:"Security K outweighs because it gives more money to the police state under the guise of 'reform.'"},
    {aff:"State-Led Reforestation",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because it often plants 'productive' monocultures rather than restoring the biodiverse lands Indigenous people managed."},
    {aff:"Protecting Undersea Cables",correct:"Security K",explanation:"Security K outweighs because it justifies the militarization of the oceans."},
    {aff:"Taxing the Ultra-Wealthy",correct:"Capitalist K",explanation:"Cap K outweighs because the wealthy will always find loopholes as long as the capitalist state exists to protect them."},
    {aff:"Constitutional Amendments",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because the Constitution is a colonial document that has no authority over sovereign Nations."},
    {aff:"Diplomacy Initiatives",correct:"Security K",explanation:"Security K outweighs because 'diplomacy' is often just a 'soft power' tool to force other countries to align with Western security interests."},
    {aff:"Increasing the Minimum Wage",correct:"Capitalist K",explanation:"Cap K outweighs because it keeps workers 'just happy enough' to keep the exploitative system running."},
    {aff:"Urban Renewal Projects",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because it is essentially 'settler gentrification' that displaces the most marginalized."},
    {aff:"Stock Market Regulations",correct:"Capitalist K",explanation:"Cap K outweighs because you cannot 'regulate' a system whose internal logic is exploitation."},
    {aff:"Anti-Money Laundering Laws",correct:"Security K",explanation:"Security K outweighs because these laws are used to freeze the assets of political dissidents and activists."},
    {aff:"Promoting 'The American Dream'",correct:"Settler Colonialism K",explanation:"Set Col K outweighs because that 'Dream' is built on the literal nightmare of Indigenous genocide."},
    {aff:"Global Nuclear Disarmament",correct:"Security K",explanation:"Security K outweighs because focusing only on 'nukes' ignores the conventional violence and 'structural' security threats the state poses."},
    {aff:"Philanthropic Foundations",correct:"Capitalist K",explanation:"Cap K outweighs because it allows billionaires to decide which social problems get solved, rather than the people themselves."}
];

let currentKritikIndex = 0;
let kritikScore = 0;
let kritikAttempts = 0;

/* THEORY DRILL DATA */
const theoryClashGrounds = [
    {scenario:"Vague Normalcy: The Aff says their plan happens through 'normal means' without details.",correct:"Grounds",explanation:"This steals Neg grounds for 'Process Disadvantages' because the Neg doesn't know which agency is acting."},
    {scenario:"Agent Specification (ASPEC): The resolution says 'The USFG should,' but the Aff refuses to pick a branch (Executive, Legislative, etc.).",correct:"Clash",explanation:"This kills clash because the Neg can't run a 'Courts Counterplan' if the Aff won't say they aren't using the Courts."},
    {scenario:"Multi-Plank Counterplans: The Neg runs one counterplan with 20 different steps.",correct:"Grounds",explanation:"This violates grounds because the Aff cannot physically address 20 different policies in a 3-minute rebuttal."},
    {scenario:"Floating PIKs (Plan-Inclusive Kritiks): A Kritik where the Neg says the plan is bad, but their 'Alternative' secretly does the plan anyway.",correct:"Clash",explanation:"This kills clash because if the Neg 'is' the Aff, there is no longer a choice for the judge to make."},
    {scenario:"Multi-Actor Fiat: The Aff forces multiple countries or agents to act simultaneously.",correct:"Grounds",explanation:"This is unfair grounds because it avoids 'International Friction' arguments the Neg usually relies on."},
    {scenario:"Severance Permutations: The Aff tries to test a counterplan by 'severing' or cutting out a piece of their original plan.",correct:"Clash",explanation:"This violates clash because the Aff is no longer defending what they said in their first speech."},
    {scenario:"Intrinsic Permutations: The Aff tries to beat a counterplan by adding a totally new, unrelated action to their plan.",correct:"Grounds",explanation:"This steals grounds because the Neg can't prepare for 'new' plan parts added mid-round."},
    {scenario:"Hidden Spikes: Tiny, one-sentence arguments hidden in the 1AC designed to be 'extended' later for an easy win.",correct:"Clash",explanation:"This kills clash by rewarding 'sneakiness' over actual topical debate."},
    {scenario:"Fictional Fiat: Using 'AI gods' or 'magic' to solve problems.",correct:"Grounds",explanation:"This violates grounds because the Neg's real-world evidence about physics or economics becomes useless."},
    {scenario:"Topic Subsets (Tiny-tasking): Picking a tiny sub-issue (e.g., 'fixing one specific bridge') instead of the whole topic.",correct:"Clash",explanation:"This kills clash because the Neg can't be expected to have evidence for every bridge in the country."},
    {scenario:"Negative Conditionality: The Neg runs several counterplans and drops them whenever they want.",correct:"Grounds",explanation:"This violates grounds because the Aff wastes time answering arguments that the Neg can just 'delete.'"},
    {scenario:"Necessary But Insufficient Burdens (NIBs): An argument where the Aff must win it to stay in the round, but winning it doesn't actually help them win the whole round.",correct:"Grounds",explanation:"This is unfair because it creates a 'one-way street' for the Neg to win."},
    {scenario:"Sandbagging: Holding back all the 'good' evidence until the last possible speech.",correct:"Clash",explanation:"This kills clash because the opponent has zero time to respond to the new evidence."},
    {scenario:"Process Counterplans: A counterplan that does the plan but through a different 'paperwork' route.",correct:"Clash",explanation:"This avoids clash with the merits of the plan, making the debate about boring legal procedures."},
    {scenario:"Cross-Apply Spreading: Reading arguments so fast that the opponent misses the 'links.'",correct:"Grounds",explanation:"This violates grounds because you can't respond to what you couldn't hear."},
    {scenario:"No Plan Text: A team that just talks about a philosophy without a specific proposal.",correct:"Clash",explanation:"This kills clash because there is no 'target' for the Neg to attack with policy evidence."},
    {scenario:"Alternative Justification: Giving three plans and saying 'If you don't like one, pick another.'",correct:"Grounds",explanation:"This violates grounds by forcing the Neg to win the debate three times over."},
    {scenario:"Delay Counterplans: The Neg says 'Do the plan, but wait a year.'",correct:"Clash",explanation:"This avoids clash because the Neg isn't actually saying the plan is a bad idea."},
    {scenario:"Performative Contradiction: Running a Kritik of 'The State' while also running a 'State-based' counterplan.",correct:"Grounds",explanation:"This violates grounds by making the Neg's 'stance' impossible for the Aff to pin down."},
    {scenario:"Word PIKs: Critiquing a single word used in the 1AC (like 'mankind').",correct:"Clash",explanation:"This derails clash by ignoring the actual 10-minute policy debate in favor of a grammar lesson."},
    {scenario:"New 2AC Impacts: The Aff adds a whole new 'World War III' impact in their second speech.",correct:"Grounds",explanation:"This violates grounds because the Neg's first speech (1NC) couldn't have accounted for it."},
    {scenario:"Consult Counterplans: Saying 'We should ask Japan if we can do the plan first.'",correct:"Clash",explanation:"This avoids clash because the debate becomes about Japan's opinion rather than the resolution."},
    {scenario:"Technology Specification: Being so specific about a machine that no general studies apply.",correct:"Grounds",explanation:"This kills Neg ground by 'out-teching' the opponent so they can't use their research."},
    {scenario:"Utopian Fiat: Assuming everyone in the world will suddenly agree to be peaceful.",correct:"Grounds",explanation:"This violates grounds because it ignores the reality of politics that the Neg is prepared to debate."},
    {scenario:"Definition Arbitrariness: Using a dictionary from 1850 to define a modern word.",correct:"Clash",explanation:"This kills clash by changing the meaning of the topic into something unrecognizable."}
];

const theoryEduFairAdv = [
    {scenario:"Time Trade-Off: The Neg reads 5 minutes of 'trash' arguments just to make the Aff waste time.",correct:"Fairness",explanation:"This violates Fairness because the round is won by the clock, not the better logic."},
    {scenario:"Topic Education: A team avoids the resolution to talk about a different topic.",correct:"Education",explanation:"This violates Education because we lose the one chance we had to learn about the assigned year's topic."},
    {scenario:"Predictability: The Aff runs a 'hidden' case no one could expect.",correct:"Fairness",explanation:"This violates Fairness because debate should be a test of research, not a test of who can 'surprise' the other more."},
    {scenario:"Stable Advocacy: A team shifts their stance halfway through the round.",correct:"Advocacy",explanation:"This violates Advocacy because a debater should be held responsible for the position they took at the start."},
    {scenario:"Policy-Making Skills: A team uses 'logical tricks' rather than data.",correct:"Education",explanation:"This violates Education because these skills don't translate to real-world lawmaking or careers."},
    {scenario:"Reciprocity: One side gets a certain 'power' (like fiat) that the other doesn't.",correct:"Fairness",explanation:"This violates Fairness because the rules must be 'symmetrical' for the game to work."},
    {scenario:"Incentives: Allowing a certain 'cheating' behavior encourages others to do it.",correct:"Education",explanation:"This violates Education because it turns the community into a 'race to the bottom' for the easiest win."},
    {scenario:"Side Constraints: The fact that the Aff speaks first and last gives them an advantage.",correct:"Fairness",explanation:"Theory balances this by ensuring Fairness through strict rules on 'New Arguments.'"},
    {scenario:"Critical Thinking: Using 'generic' counterplans that apply to every topic.",correct:"Education",explanation:"This violates Education because students just read the same file for 4 years instead of thinking."},
    {scenario:"Competitive Equity: Large teams with 10 coaches vs. small teams with none.",correct:"Fairness",explanation:"Theory arguments against 'obscure cases' protect Fairness for smaller schools."},
    {scenario:"Jurisdiction: The judge only has the 'right' to vote on the resolution. If the Aff is non-topical, it violates Fairness.",correct:"Fairness",explanation:"The judge is acting outside their 'job description' when voting on non-topical cases."},
    {scenario:"Depth over Breadth: Debating one idea for an hour vs. 50 ideas for one minute.",correct:"Education",explanation:"Too many arguments violate Education because we never get past the surface level."},
    {scenario:"State-Centric Bias: The idea that all solutions must come from the government.",correct:"Advocacy",explanation:"K-Affs argue that policy-only debate violates Advocacy by limiting our imagination to the 'status quo.'"},
    {scenario:"Clash as a Filter: Only good ideas survive tough questions.",correct:"Education",explanation:"Avoiding clash violates Education because we never find out if the plan is actually a bad idea."},
    {scenario:"Moving Goalposts: Changing the 'definition of success' during the round.",correct:"Fairness",explanation:"This violates Fairness because the opponent is aiming at a target that keeps moving."},
    {scenario:"Research Burdens: Expecting a student to have read every book ever written.",correct:"Fairness",explanation:"'Squirrel' cases violate Fairness because they impose an impossible research burden on the Neg."},
    {scenario:"Real-World Utility: Can you use this argument in a courtroom or city hall?",correct:"Education",explanation:"'Fictional' arguments violate Education because they have zero utility outside the debate room."},
    {scenario:"Procedural Fairness: The 'Rules of the Road.'",correct:"Fairness",explanation:"Without theory, there is no Fairness because every round would have different rules based on who spoke loudest."},
    {scenario:"Argumentative Responsibility: You must 'own' the impacts of your words.",correct:"Advocacy",explanation:"Violating this kills Advocacy because it turns debate into a 'game' with no moral consequences."},
    {scenario:"Switch-Side Debate: The requirement to argue for and against the topic.",correct:"Education",explanation:"This promotes Education by teaching us to see the world from our opponent's perspective."},
    {scenario:"Infinite Regression: If the Neg can have 2 counterplans, why not 100?",correct:"Fairness",explanation:"Theory sets a 'limit' to ensure Fairness so the game doesn't break."},
    {scenario:"Grammatical Integrity: Following the 'comma' and 'and' in the resolution.",correct:"Education",explanation:"This ensures Education by making us better writers and analysts of law."},
    {scenario:"Litigation Ground: The Neg needs a 'target' to attack.",correct:"Fairness",explanation:"Vague plans violate Fairness by taking away the Neg's right to 'litigate' the plan."},
    {scenario:"Engagement: The requirement to actually talk to each other.",correct:"Education",explanation:"'Performance' cases that ignore the other team violate Education by stopping the dialogue."},
    {scenario:"Judge Intervention: Rules prevent the judge from just 'picking their favorite.'",correct:"Fairness",explanation:"Theory ensures Fairness by giving the judge a mathematical way to decide who 'played the game' better."}
];

let currentTheoryIndex = 0;
let theoryScore = 0;
let theoryAttempts = 0;
let theoryCategory = "clash";
let currentTheoryScenarios = [];

function loadImpactCalcQuestion() {
    const scenario = impactCalcScenarios[currentQuestionIndex];
    document.getElementById('impact1').textContent = scenario.impact1;
    document.getElementById('impact2').textContent = scenario.impact2;
    document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
    document.getElementById('totalQuestions').textContent = impactCalcScenarios.length;
    document.getElementById('explanationBox').classList.add('hidden');
    document.getElementById('continueBtn').classList.add('hidden');
    
    const buttons = document.querySelectorAll('.answer-btn');
    buttons.forEach(btn => {
        btn.disabled = false;
        btn.className = "answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition";
    });
}

function checkAnswer(selectedAnswer) {
    const scenario = impactCalcScenarios[currentQuestionIndex];
    const buttons = document.querySelectorAll('.answer-btn');
    const isCorrect = selectedAnswer === scenario.correct;
    
    attempts++;
    if (isCorrect) score++;
    
    document.getElementById('scoreDisplay').textContent = score;
    document.getElementById('attemptDisplay').textContent = attempts;
    
    buttons.forEach(btn => {
        btn.disabled = true;
        const btnAnswer = btn.getAttribute('data-answer');
        
        if (btnAnswer === scenario.correct) {
            btn.className = "answer-btn py-4 px-6 rounded-lg border-4 border-green-500 bg-green-100 font-semibold text-green-900";
        } else if (btnAnswer === selectedAnswer && !isCorrect) {
            btn.className = "answer-btn py-4 px-6 rounded-lg border-4 border-red-500 bg-red-100 font-semibold text-red-900";
        }
    });
    
    document.getElementById('explanationText').textContent = scenario.explanation;
    document.getElementById('explanationBox').classList.remove('hidden');
    
    setTimeout(() => {
        document.getElementById('continueBtn').classList.remove('hidden');
    }, 1000);
}

function nextImpactCalcQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex >= impactCalcScenarios.length) {
        document.getElementById('explanationBox').innerHTML = 
            `<p class="text-2xl font-bold text-purple-900 text-center">üéâ Drill Complete! üéâ</p>
             <p class="text-xl text-center mt-4">Final Score: ${score} / ${attempts}</p>
             <p class="text-lg text-center mt-2 text-slate-600">Accuracy: ${Math.round((score/attempts)*100)}%</p>`;
        document.getElementById('continueBtn').textContent = "Restart Drill";
        document.getElementById('continueBtn').onclick = () => {
            currentQuestionIndex = 0;
            score = 0;
            attempts = 0;
            document.getElementById('scoreDisplay').textContent = '0';
            document.getElementById('attemptDisplay').textContent = '0';
            document.getElementById('continueBtn').textContent = "Click to Continue ‚Üí";
            document.getElementById('continueBtn').onclick = nextImpactCalcQuestion;
            loadImpactCalcQuestion();
        };
    } else {
        loadImpactCalcQuestion();
    }
}

document.querySelectorAll('.answer-btn').forEach(btn => {
    btn.onclick = () => checkAnswer(btn.getAttribute('data-answer'));
});

document.getElementById('continueBtn').onclick = nextImpactCalcQuestion;

/* KRITIK DRILL FUNCTIONS */
function loadKritikQuestion() {
    const scenario = kritikScenarios[currentKritikIndex];
    document.getElementById('affPlan').textContent = scenario.aff;
    document.getElementById('kritikQuestionNumber').textContent = currentKritikIndex + 1;
    document.getElementById('kritikTotalQuestions').textContent = kritikScenarios.length;
    document.getElementById('kritikExplanationBox').classList.add('hidden');
    document.getElementById('kritikContinueBtn').classList.add('hidden');
    
    const buttons = document.querySelectorAll('.kritik-answer-btn');
    buttons.forEach(btn => {
        btn.disabled = false;
        btn.className = "kritik-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition";
    });
}

function checkKritikAnswer(selectedAnswer) {
    const scenario = kritikScenarios[currentKritikIndex];
    const buttons = document.querySelectorAll('.kritik-answer-btn');
    const isCorrect = selectedAnswer === scenario.correct;
    
    kritikAttempts++;
    if (isCorrect) kritikScore++;
    
    document.getElementById('kritikScoreDisplay').textContent = kritikScore;
    document.getElementById('kritikAttemptDisplay').textContent = kritikAttempts;
    
    buttons.forEach(btn => {
        btn.disabled = true;
        const btnAnswer = btn.getAttribute('data-answer');
        
        if (btnAnswer === scenario.correct) {
            btn.className = "kritik-answer-btn py-4 px-6 rounded-lg border-4 border-green-500 bg-green-100 font-semibold text-green-900";
        } else if (btnAnswer === selectedAnswer && !isCorrect) {
            btn.className = "kritik-answer-btn py-4 px-6 rounded-lg border-4 border-red-500 bg-red-100 font-semibold text-red-900";
        }
    });
    
    document.getElementById('kritikExplanationText').textContent = scenario.explanation;
    document.getElementById('kritikExplanationBox').classList.remove('hidden');
    
    setTimeout(() => {
        document.getElementById('kritikContinueBtn').classList.remove('hidden');
    }, 1000);
}

function nextKritikQuestion() {
    currentKritikIndex++;
    if (currentKritikIndex >= kritikScenarios.length) {
        document.getElementById('kritikExplanationBox').innerHTML = 
            `<p class="text-2xl font-bold text-purple-900 text-center">üéâ Drill Complete! üéâ</p>
             <p class="text-xl text-center mt-4">Final Score: ${kritikScore} / ${kritikAttempts}</p>
             <p class="text-lg text-center mt-2 text-slate-600">Accuracy: ${Math.round((kritikScore/kritikAttempts)*100)}%</p>`;
        document.getElementById('kritikContinueBtn').textContent = "Restart Drill";
        document.getElementById('kritikContinueBtn').onclick = () => {
            currentKritikIndex = 0;
            kritikScore = 0;
            kritikAttempts = 0;
            document.getElementById('kritikScoreDisplay').textContent = '0';
            document.getElementById('kritikAttemptDisplay').textContent = '0';
            document.getElementById('kritikContinueBtn').textContent = "Click to Continue ‚Üí";
            document.getElementById('kritikContinueBtn').onclick = nextKritikQuestion;
            loadKritikQuestion();
        };
    } else {
        loadKritikQuestion();
    }
}

document.querySelectorAll('.kritik-answer-btn').forEach(btn => {
    btn.onclick = () => checkKritikAnswer(btn.getAttribute('data-answer'));
});

document.getElementById('kritikContinueBtn').onclick = nextKritikQuestion;

/* THEORY DRILL FUNCTIONS */
document.getElementById('startClashGrounds').onclick = () => {
    theoryCategory = "clash";
    currentTheoryScenarios = theoryClashGrounds;
    currentTheoryIndex = 0;
    theoryScore = 0;
    theoryAttempts = 0;
    document.getElementById('theoryScoreDisplay').textContent = '0';
    document.getElementById('theoryAttemptDisplay').textContent = '0';
    document.getElementById('theoryTotalQuestions').textContent = currentTheoryScenarios.length;
    document.getElementById('theoryCategoryDisplay').textContent = "Clash / Grounds";
    document.getElementById('theoryCategoryScreen').classList.add('hidden');
    document.getElementById('theoryQuizScreen').classList.remove('hidden');
    setupTheoryButtons();
    loadTheoryQuestion();
};

document.getElementById('startEduFairAdv').onclick = () => {
    theoryCategory = "edu";
    currentTheoryScenarios = theoryEduFairAdv;
    currentTheoryIndex = 0;
    theoryScore = 0;
    theoryAttempts = 0;
    document.getElementById('theoryScoreDisplay').textContent = '0';
    document.getElementById('theoryAttemptDisplay').textContent = '0';
    document.getElementById('theoryTotalQuestions').textContent = currentTheoryScenarios.length;
    document.getElementById('theoryCategoryDisplay').textContent = "Education / Fairness / Advocacy";
    document.getElementById('theoryCategoryScreen').classList.add('hidden');
    document.getElementById('theoryQuizScreen').classList.remove('hidden');
    setupTheoryButtons();
    loadTheoryQuestion();
};

function setupTheoryButtons() {
    const container = document.getElementById('theoryAnswerButtons');
    container.innerHTML = '';
    
    if (theoryCategory === "clash") {
        container.innerHTML = `
            <button class="theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Clash">
                Clash
            </button>
            <button class="theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Grounds">
                Grounds
            </button>
        `;
    } else {
        container.innerHTML = `
            <button class="theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Education">
                Education
            </button>
            <button class="theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Fairness">
                Fairness
            </button>
            <button class="theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition" data-answer="Advocacy">
                Advocacy
            </button>
        `;
    }
    
    document.querySelectorAll('.theory-answer-btn').forEach(btn => {
        btn.onclick = () => checkTheoryAnswer(btn.getAttribute('data-answer'));
    });
}

function loadTheoryQuestion() {
    const scenario = currentTheoryScenarios[currentTheoryIndex];
    document.getElementById('theoryScenario').textContent = scenario.scenario;
    document.getElementById('theoryQuestionNumber').textContent = currentTheoryIndex + 1;
    document.getElementById('theoryExplanationBox').classList.add('hidden');
    document.getElementById('theoryContinueBtn').classList.add('hidden');
    
    const buttons = document.querySelectorAll('.theory-answer-btn');
    buttons.forEach(btn => {
        btn.disabled = false;
        btn.className = "theory-answer-btn bg-white hover:bg-purple-100 py-4 px-6 rounded-lg border-2 border-purple-300 font-semibold text-purple-900 transition";
    });
}

function checkTheoryAnswer(selectedAnswer) {
    const scenario = currentTheoryScenarios[currentTheoryIndex];
    const buttons = document.querySelectorAll('.theory-answer-btn');
    const isCorrect = selectedAnswer === scenario.correct;
    
    theoryAttempts++;
    if (isCorrect) theoryScore++;
    
    document.getElementById('theoryScoreDisplay').textContent = theoryScore;
    document.getElementById('theoryAttemptDisplay').textContent = theoryAttempts;
    
    buttons.forEach(btn => {
        btn.disabled = true;
        const btnAnswer = btn.getAttribute('data-answer');
        
        if (btnAnswer === scenario.correct) {
            btn.className = "theory-answer-btn py-4 px-6 rounded-lg border-4 border-green-500 bg-green-100 font-semibold text-green-900";
        } else if (btnAnswer === selectedAnswer && !isCorrect) {
            btn.className = "theory-answer-btn py-4 px-6 rounded-lg border-4 border-red-500 bg-red-100 font-semibold text-red-900";
        }
    });
    
    document.getElementById('theoryExplanationText').textContent = scenario.explanation;
    document.getElementById('theoryExplanationBox').classList.remove('hidden');
    
    setTimeout(() => {
        document.getElementById('theoryContinueBtn').classList.remove('hidden');
    }, 1000);
}

function nextTheoryQuestion() {
    currentTheoryIndex++;
    if (currentTheoryIndex >= currentTheoryScenarios.length) {
        document.getElementById('theoryExplanationBox').innerHTML = 
            `<p class="text-2xl font-bold text-purple-900 text-center">üéâ Drill Complete! üéâ</p>
             <p class="text-xl text-center mt-4">Final Score: ${theoryScore} / ${theoryAttempts}</p>
             <p class="text-lg text-center mt-2 text-slate-600">Accuracy: ${Math.round((theoryScore/theoryAttempts)*100)}%</p>`;
        document.getElementById('theoryContinueBtn').textContent = "Restart Drill";
        document.getElementById('theoryContinueBtn').onclick = () => {
            currentTheoryIndex = 0;
            theoryScore = 0;
            theoryAttempts = 0;
            document.getElementById('theoryScoreDisplay').textContent = '0';
            document.getElementById('theoryAttemptDisplay').textContent = '0';
            document.getElementById('theoryContinueBtn').textContent = "Click to Continue ‚Üí";
            document.getElementById('theoryContinueBtn').onclick = nextTheoryQuestion;
            loadTheoryQuestion();
        };
    } else {
        loadTheoryQuestion();
    }
}

document.getElementById('theoryContinueBtn').onclick = nextTheoryQuestion;

/* DRILL MENU NAVIGATION */
document.getElementById('selectPiratesDrill').onclick = () => {
    document.getElementById('drillMenu').classList.add('hidden');
    document.getElementById('piratesDrill').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.remove('hidden');
};

document.getElementById('selectImpactCalcDrill').onclick = () => {
    document.getElementById('drillMenu').classList.add('hidden');
    document.getElementById('impactCalcDrill').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.remove('hidden');
    currentQuestionIndex = 0;
    score = 0;
    attempts = 0;
    document.getElementById('scoreDisplay').textContent = '0';
    document.getElementById('attemptDisplay').textContent = '0';
    loadImpactCalcQuestion();
};

document.getElementById('selectKritikDrill').onclick = () => {
    document.getElementById('drillMenu').classList.add('hidden');
    document.getElementById('kritikDrill').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.remove('hidden');
    currentKritikIndex = 0;
    kritikScore = 0;
    kritikAttempts = 0;
    document.getElementById('kritikScoreDisplay').textContent = '0';
    document.getElementById('kritikAttemptDisplay').textContent = '0';
    loadKritikQuestion();
};

document.getElementById('selectTheoryDrill').onclick = () => {
    console.log("Theory drill clicked");
    document.getElementById('drillMenu').classList.add('hidden');
    document.getElementById('theoryDrill').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.remove('hidden');
    document.getElementById('theoryCategoryScreen').classList.remove('hidden');
    document.getElementById('theoryQuizScreen').classList.add('hidden');
};

document.getElementById('backToDrillMenu').onclick = () => {
    document.getElementById('drillMenu').classList.remove('hidden');
    document.getElementById('piratesDrill').classList.add('hidden');
    document.getElementById('impactCalcDrill').classList.add('hidden');
    document.getElementById('kritikDrill').classList.add('hidden');
    document.getElementById('theoryDrill').classList.add('hidden');
    document.getElementById('backToDrillMenu').classList.add('hidden');
    resetDrill();
};

document.getElementById('backFromPirates').onclick = () => {
    document.getElementById('piratesDrill').classList.add('hidden');
    document.getElementById('drillMenu').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.add('hidden');
    resetDrill();
};

document.getElementById('backFromImpact').onclick = () => {
    document.getElementById('impactCalcDrill').classList.add('hidden');
    document.getElementById('drillMenu').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.add('hidden');
};

document.getElementById('backFromKritik').onclick = () => {
    document.getElementById('kritikDrill').classList.add('hidden');
    document.getElementById('drillMenu').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.add('hidden');
};

document.getElementById('backFromTheory').onclick = () => {
    document.getElementById('theoryDrill').classList.add('hidden');
    document.getElementById('drillMenu').classList.remove('hidden');
    document.getElementById('backToDrillMenu').classList.add('hidden');
    document.getElementById('theoryCategoryScreen').classList.remove('hidden');
    document.getElementById('theoryQuizScreen').classList.add('hidden');
};

/* TUTORIAL SYSTEM */
let tutorialStep = 0;
const tutorialSteps = [
    {text:"Hi there! This is the HamiltonPro Website!",spotlight:"main-header",action:null},
    {text:"First, let me show you the Counter-Speech Generator",spotlight:"counterTab",action:function(){document.getElementById('counterTab').click();}},
    {text:"In this screen, you can enter your case and get either a speech or a case against it!",spotlight:"generateCounterBtn",action:null},
    {text:"Next, I'll show you the Write Me a Case function!",spotlight:"caseTab",action:function(){document.getElementById('caseTab').click();}},
    {text:"Here, you can enter a topic, pick your side, and two FOCUS POINTS.",spotlight:"generateCaseBtn",action:null},
    {text:"Now check out our new Drills section with multiple practice exercises!",spotlight:"drillsTab",action:function(){document.getElementById('drillsTab').click();}},
    {text:"Choose from speaking drills or impact calculus practice!",spotlight:"drillMenu",action:null},
    {text:"Thanks for finishing the tutorial for HamiltonPro!",spotlight:null,action:null}
];

function startTutorial() {
    tutorialStep = 0;
    document.getElementById("tutorial-overlay").style.display = "block";
    document.getElementById("tutorial-dialog").style.display = "block";
    document.getElementById("hamilton-click-prompt").style.display = "none";
    showTutorialStep();
}

function showTutorialStep() {
    const step = tutorialSteps[tutorialStep];
    document.getElementById("tutorial-text").textContent = step.text;

    if (step.spotlight) {
        const el = document.getElementById(step.spotlight);
        if (el) {
            const r = el.getBoundingClientRect();
            const s = document.getElementById("tutorial-spotlight");
            s.style.left = (r.left-10)+"px";
            s.style.top = (r.top-10)+"px";
            s.style.width = (r.width+20)+"px";
            s.style.height = (r.height+20)+"px";
            s.style.display = "block";
        }
    } else {
        document.getElementById("tutorial-spotlight").style.display = "none";
    }

    if (step.action) setTimeout(step.action,100);
}

function nextTutorialStep() {
    tutorialStep++;
    if (tutorialStep >= tutorialSteps.length) {
        document.getElementById("tutorial-overlay").style.display = "none";
        document.getElementById("tutorial-dialog").style.display = "none";
        document.getElementById("tutorial-spotlight").style.display = "none";
        document.getElementById("hamilton-click-prompt").style.display = "none";
    } else {
        showTutorialStep();
    }
}

document.getElementById("tutorial-dialog").onclick = nextTutorialStep;
document.getElementById("hamilton-container").addEventListener("click",startTutorial);

console.log("HamiltonPro initialized successfully!");
</script>

</body>
</html>
