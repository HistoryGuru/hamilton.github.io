<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamilton – Intelligent Debate Speech Generator</title>

<script src="https://js.puter.com/v2/"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

<style>
[contenteditable]:empty:before {
    content: attr(data-placeholder);
    color: #94a3b8;
    font-style: italic;
}

.debate-card {
    font-family: 'Times New Roman', serif;
    line-height: 1.6;
    color: #1e293b;
    margin-bottom: 1.5em;
}

.debate-card .tag {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 0.5em;
    display: block;
}

.debate-card .cite {
    font-size: 0.95em;
    margin-bottom: 0.3em;
    font-style: italic;
}

.debate-card .shrunk {
    font-size: 0.75em;
    line-height: 1.3;
    color: #64748b;
}

.debate-card mark {
    background-color: #7dd3fc;
}
</style>
</head>

<body class="min-h-screen p-6" style="background: linear-gradient(135deg,#f4a03c,#e8952e,#f4a03c);">

<div class="max-w-6xl mx-auto pb-16">

<header class="text-center mb-8">
    <h1 class="text-5xl font-bold text-slate-900">Hamilton</h1>
    <p class="text-slate-800">Intelligent Debate Speech Generator</p>
</header>

<div class="flex justify-center mb-6">
    <button class="px-6 py-3 rounded bg-slate-900 text-white font-semibold">
        Write Me a Case
    </button>
</div>

<div class="grid md:grid-cols-2 gap-6">

<div class="bg-white/90 p-6 rounded border-2 border-slate-300 shadow-lg">
    <input id="topic" class="w-full p-3 border-2 rounded" placeholder="Topic / Resolution">

    <input id="focusPoint1" class="w-full mt-3 p-3 border-2 rounded" placeholder="Focus Point 1">

    <div class="flex items-center gap-2 mt-2">
        <label>Cards:</label>
        <input id="cardsPerPoint1" type="number" value="2" min="1" max="10"
               class="w-16 border-2 rounded text-center">
    </div>

    <button id="generateCaseBtn"
        class="w-full mt-4 bg-slate-900 text-white py-3 rounded font-semibold">
        Generate Case
    </button>
</div>

<div class="bg-white/90 p-6 rounded border-2 border-slate-300 shadow-lg">
    <h2 class="text-xl font-semibold mb-3">Generated Case</h2>
    <div class="bg-white p-4 rounded border-2 overflow-y-scroll" style="height:1000px">
        <div id="caseOutput"></div>
    </div>
</div>

</div>
</div>

<script>
async function callAI(system, user, maxTokens = 3000) {
    const r = await puter.ai.chat(
        [{ role: "system", content: system }, { role: "user", content: user }],
        { model: "claude-sonnet-4-20250514", temperature: 0.7, max_tokens: maxTokens }
    );
    return r.message.content.map(b => b.text).join("");
}

/* =========================================================
   DOCX EXPORT — FULL FORMATTING
   ========================================================= */
function exportCaseToDocx(html, topic) {
    const { Document, Paragraph, TextRun, Packer, PageBreak } = docx;

    const safeName = topic
        .trim()
        .replace(/[^a-z0-9]+/gi, "_")
        .toLowerCase();

    const temp = document.createElement("div");
    temp.innerHTML = html;

    const children = [];
    let currentContention = null;

    temp.querySelectorAll(".debate-card").forEach((card, index) => {

        const tag = card.querySelector(".tag")?.innerText || "";

        if (tag !== currentContention) {
            if (index !== 0) {
                children.push(new Paragraph({ children: [new PageBreak()] }));
            }
            currentContention = tag;
        }

        children.push(
            new Paragraph({
                children: [
                    new TextRun({ text: tag, bold: true })
                ],
                spacing: { after: 200 }
            })
        );

        const cite = card.querySelector(".cite");
        if (cite) {
            const text = cite.innerText;
            const match = text.match(/^(.+?'\\d{2})/);

            children.push(
                new Paragraph({
                    children: [
                        new TextRun({
                            text: match ? match[1] : text,
                            bold: true,
                            italics: true
                        }),
                        new TextRun({
                            text: match ? text.replace(match[1], "") : "",
                            italics: true
                        })
                    ],
                    spacing: { after: 200 }
                })
            );
        }

        const body = new Paragraph();

        card.querySelectorAll(".card-text *").forEach(el => {
            const txt = el.innerText;
            if (!txt) return;

            body.addChildElement(
                new TextRun({
                    text: txt,
                    bold: el.tagName === "STRONG",
                    underline: el.tagName === "U",
                    highlight: el.tagName === "MARK" ? "cyan" : undefined
                })
            );
        });

        children.push(body);
        children.push(new Paragraph(""));
    });

    const doc = new Document({
        sections: [{ children }]
    });

    Packer.toBlob(doc).then(blob => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `${safeName}-hamiltonDebate.docx`;
        a.click();
        URL.revokeObjectURL(a.href);
    });
}

/* =========================================================
   CASE GENERATION
   ========================================================= */
document.getElementById("generateCaseBtn").onclick = async () => {
    const output = document.getElementById("caseOutput");
    const topic = document.getElementById("topic").value || "debate";

    output.innerHTML = "<p class='italic text-slate-500'>Generating...</p>";

    const html = await callAI(
        "You are an expert debate case writer.",
        "Write a formatted debate case with evidence cards."
    );

    const temp = document.createElement("div");
    temp.innerHTML = html;
    const cards = temp.querySelectorAll(".debate-card");

    if (cards.length > 8) {
        output.innerHTML =
            Array.from(cards).slice(0, 8).map(c => c.outerHTML).join("") +
            `<div class="mt-6 text-center">
                <button class="bg-slate-900 text-white px-6 py-3 rounded font-semibold"
                    onclick='exportCaseToDocx(${JSON.stringify(html)}, ${JSON.stringify(topic)})'>
                    Download Full Case (.docx)
                </button>
            </div>`;
    } else {
        output.innerHTML = html;
    }
};
</script>

<footer class="fixed bottom-0 inset-x-0 bg-slate-900 text-white text-center py-2 text-sm">
All Code by Leroy Qu
</footer>

</body>
</html>
