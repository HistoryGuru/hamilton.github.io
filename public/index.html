<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamilton – Intelligent Debate Speech Generator</title>

<script src="https://js.puter.com/v2/"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
[contenteditable]:empty:before {
    content: attr(data-placeholder);
    color: #94a3b8;
    font-style: italic;
}
mark {
    background-color: yellow;
    color: black;
}
.generated-case strong {
    color: #fbbf24;
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
<div class="max-w-6xl mx-auto">

<header class="text-center mb-8">
    <h1 class="text-5xl font-bold text-amber-400">Hamilton</h1>
    <p class="text-slate-300">Intelligent Debate Speech Generator</p>
</header>

<!-- Tabs -->
<div class="flex gap-4 mb-6 justify-center">
    <button id="counterTab" class="px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold">
        Counter-Speech Generator
    </button>
    <button id="caseTab" class="px-6 py-3 rounded bg-slate-800 text-slate-300">
        Write Me a Case
    </button>
</div>

<!-- COUNTER SPEECH -->
<div id="counterSection">
<div class="grid md:grid-cols-2 gap-6">

<!-- INPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Case Input</h2>

    <div id="caseInput" contenteditable
        class="bg-slate-900 h-64 p-4 rounded border border-slate-600 text-slate-100 overflow-y-auto"
        data-placeholder="Paste your formatted debate case here...">
    </div>

    <label class="block text-slate-300 mt-4">
        Speech Length: <span id="speechLengthDisplay">3</span> minutes
    </label>
    <input id="speechLength" type="range" min="1" max="8" value="3" class="w-full">

    <button id="generateCounterBtn"
        class="w-full mt-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-3 rounded">
        Generate Counter-Speech
    </button>
</div>

<!-- OUTPUT -->
<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Counter-Speech</h2>
    <div class="bg-slate-900 p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <p id="counterOutput" class="text-slate-400 italic">
            Your generated counter-speech will appear here…
        </p>
    </div>
</div>

</div>
</div>

<!-- CASE WRITER -->
<div id="caseSection" class="hidden">
<div class="grid md:grid-cols-2 gap-6">

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <input id="topic"
        class="w-full p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Topic / Resolution">

    <div class="flex gap-2 mt-3">
        <button id="affBtn" class="flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900">
            Affirmative
        </button>
        <button id="negBtn" class="flex-1 bg-slate-700 py-2 rounded text-slate-300">
            Negative
        </button>
    </div>

    <input id="focusPoint1"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Focus Point 1 (Required)">

    <input id="focusPoint2"
        class="w-full mt-3 p-3 bg-slate-900 border border-slate-600 rounded text-slate-100"
        placeholder="Focus Point 2 (Optional)">

    <button id="generateCaseBtn"
        class="w-full mt-4 bg-amber-500 hover:bg-amber-600 py-3 rounded font-semibold text-slate-900">
        Generate Case
    </button>
</div>

<div class="bg-slate-800/50 p-6 rounded border border-slate-700">
    <h2 class="text-xl font-semibold text-amber-400 mb-3">Generated Case</h2>
    <div class="bg-slate-900 p-4 h-96 rounded overflow-y-auto border border-slate-600">
        <div id="caseOutput" class="text-slate-300 italic generated-case">
            Your generated case will appear here…
        </div>
    </div>
</div>

</div>
</div>

</div>

<script>
/* =========================================================
   CENTRALIZED AI CALL (PUTER AI)
   ========================================================= */
async function callAI(system, user, maxTokens = 1200) {
    try {
        const response = await puter.ai.chat([
            { role: "system", content: system },
            { role: "user", content: user }
        ], {
            model: "claude-sonnet-4-20250514",
            temperature: 0.7,
            max_tokens: maxTokens
        });

        console.log("Puter AI Response:", response);

        // Extract text from Puter's response - the actual content is in message.content
        if (response.message && response.message.content) {
            // Content is an array with text blocks
            if (Array.isArray(response.message.content)) {
                return response.message.content
                    .filter(block => block.type === 'text')
                    .map(block => block.text)
                    .join('\n');
            }
            return response.message.content;
        }
        
        // Fallback to other possible structures
        if (typeof response === 'string') {
            return response;
        } else if (response.text) {
            return response.text;
        } else if (response.content) {
            return response.content;
        }
        
        return JSON.stringify(response, null, 2);
    } catch (error) {
        console.error("AI Error:", error);
        throw new Error("AI request failed: " + error.message);
    }
}

/* =========================================================
   TAB LOGIC
   ========================================================= */
document.getElementById('counterTab').onclick = () => {
    document.getElementById('counterSection').classList.remove("hidden");
    document.getElementById('caseSection').classList.add("hidden");
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold";
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-slate-800 text-slate-300";
};
document.getElementById('caseTab').onclick = () => {
    document.getElementById('caseSection').classList.remove("hidden");
    document.getElementById('counterSection').classList.add("hidden");
    document.getElementById('caseTab').className = "px-6 py-3 rounded bg-amber-500 text-slate-900 font-semibold";
    document.getElementById('counterTab').className = "px-6 py-3 rounded bg-slate-800 text-slate-300";
};

/* =========================================================
   COUNTER SPEECH
   ========================================================= */
document.getElementById('speechLength').oninput = e =>
    document.getElementById('speechLengthDisplay').textContent = e.target.value;

document.getElementById('generateCounterBtn').onclick = async () => {
    const counterOutput = document.getElementById('counterOutput');
    const caseInput = document.getElementById('caseInput');
    const speechLength = document.getElementById('speechLength');
    
    counterOutput.textContent = "Generating…";

    const prompt = `
Generate a ${speechLength.value}-minute rebuttal speech
against the following case:

${caseInput.innerText}

Be structured, analytical, and persuasive.
    `;

    try {
        const text = await callAI(
            "You are a high-level debate coach.",
            prompt,
            speechLength.value * 180
        );
        counterOutput.innerText = text;
    } catch (err) {
        counterOutput.innerText = err.message;
    }
};

/* =========================================================
   CASE GENERATOR
   ========================================================= */
let side = "Aff";
document.getElementById('affBtn').onclick = () => {
    side = "Aff";
    document.getElementById('affBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('negBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};
document.getElementById('negBtn').onclick = () => {
    side = "Neg";
    document.getElementById('negBtn').className = "flex-1 bg-amber-500 py-2 rounded font-semibold text-slate-900";
    document.getElementById('affBtn').className = "flex-1 bg-slate-700 py-2 rounded text-slate-300";
};

document.getElementById('generateCaseBtn').onclick = async () => {
    const caseOutput = document.getElementById('caseOutput');
    const topic = document.getElementById('topic');
    const focusPoint1 = document.getElementById('focusPoint1');
    const focusPoint2 = document.getElementById('focusPoint2');
    
    caseOutput.innerText = "Generating…";

    const prompt = `
Write a complete ${side} debate case on:
"${topic.value}"

Focus points:
${focusPoint1.value}
${focusPoint2.value || ""}

Use HTML formatting with <strong> tags for emphasis and <br> for line breaks.
Include contentions, evidence, and analysis.
    `;

    try {
        const text = await callAI(
            "You are an expert debate case writer.",
            prompt,
            2000
        );
        caseOutput.innerHTML = text;
    } catch (err) {
        caseOutput.innerText = err.message;
    }
};
</script>

</body>
</html>
