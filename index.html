<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamilton - Intelligent Debate Speech Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        [contenteditable]:empty:before {
            content: attr(data-placeholder);
            color: #94a3b8;
            font-style: italic;
        }
        [contenteditable] mark,
        [contenteditable] em {
            background-color: yellow;
            color: black;
        }
        mark {
            background-color: yellow;
            color: black;
        }
        .generated-case strong {
            font-weight: bold;
            color: #fbbf24;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-5xl font-bold text-amber-400 mb-2">Hamilton</h1>
            <p class="text-slate-300 text-lg">Intelligent Debate Speech Generator</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex gap-4 mb-6 justify-center">
            <button id="counterTab" class="px-6 py-3 rounded-lg font-semibold transition-colors bg-amber-500 text-slate-900">
                Counter-Speech Generator
            </button>
            <button id="caseTab" class="px-6 py-3 rounded-lg font-semibold transition-colors bg-slate-800 text-slate-300 hover:bg-slate-700">
                Write Me a Case
            </button>
        </div>

        <!-- Counter-Speech Section -->
        <div id="counterSection">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-6 border border-slate-700">
                    <h2 class="text-2xl font-semibold text-amber-400 mb-4">Case Input</h2>
                    
                    <div id="caseInput" contenteditable="true" 
                         class="w-full h-64 bg-slate-900 text-slate-100 p-4 rounded border border-slate-600 focus:border-amber-400 focus:outline-none overflow-y-auto"
                         data-placeholder="Paste your formatted case here (highlights and bold preserved)...">
                    </div>

                    <div class="mt-4 space-y-4">
                        <div>
                            <label class="block text-slate-300 mb-2">
                                Speech Length: <span id="speechLengthDisplay">3</span> minutes
                            </label>
                            <input type="range" id="speechLength" min="1" max="8" value="3" class="w-full">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>1 min</span>
                                <span>8 min</span>
                            </div>
                        </div>

                        <button id="generateCounterBtn" 
                                class="w-full bg-amber-500 hover:bg-amber-600 disabled:bg-slate-600 text-slate-900 font-semibold py-3 rounded transition-colors flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                            </svg>
                            Generate Counter-Speech
                        </button>
                    </div>

                    <div id="parsedArgsDisplay" class="mt-4 p-3 bg-slate-900/50 rounded border border-slate-600 hidden">
                        <h3 class="text-sm font-semibold text-amber-400 mb-2">
                            Detected Arguments: <span id="argCount">0</span>
                        </h3>
                        <div id="argsList" class="space-y-2 text-xs text-slate-300"></div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-6 border border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-amber-400">Counter-Speech</h2>
                        <div id="counterActions" class="flex gap-2 hidden">
                            <button id="copyCounterBtn" class="p-2 bg-slate-700 hover:bg-slate-600 rounded transition-colors" title="Copy to clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-slate-300">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                            <button id="downloadCounterBtn" class="p-2 bg-slate-700 hover:bg-slate-600 rounded transition-colors" title="Download">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-slate-300">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="bg-slate-900 rounded p-4 h-96 overflow-y-auto border border-slate-600">
                        <p id="counterOutput" class="text-slate-400 italic">
                            Your generated counter-speech will appear here...
                        </p>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-slate-800/30 backdrop-blur rounded-lg p-4 border border-slate-700">
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="inline mr-2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    How to Use
                </h3>
                <div class="text-slate-300 text-sm space-y-2">
                    <p><strong>Step 1:</strong> Copy your formatted debate case from your word processor</p>
                    <p><strong>Step 2:</strong> Paste it directly into the input box - all formatting will be preserved!</p>
                    <p><strong>Step 3:</strong> Hamilton will automatically detect highlighted text, bold tags, and author citations</p>
                    <p><strong>Step 4:</strong> Adjust speech length and click generate!</p>
                </div>
            </div>
        </div>

        <!-- Case Writer Section -->
        <div id="caseSection" class="hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-6 border border-slate-700">
                    <h2 class="text-2xl font-semibold text-amber-400 mb-4">Case Parameters</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-slate-300 mb-2 font-semibold">Topic / Resolution</label>
                            <input type="text" id="topic" placeholder="We should ban nuclear weapons"
                                   class="w-full bg-slate-900 text-slate-100 p-3 rounded border border-slate-600 focus:border-amber-400 focus:outline-none">
                        </div>

                        <div>
                            <label class="block text-slate-300 mb-2 font-semibold">Side</label>
                            <div class="flex gap-4">
                                <button id="affBtn" class="flex-1 py-2 rounded font-semibold transition-colors bg-amber-500 text-slate-900">
                                    Affirmative
                                </button>
                                <button id="negBtn" class="flex-1 py-2 rounded font-semibold transition-colors bg-slate-700 text-slate-300 hover:bg-slate-600">
                                    Negative
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-slate-300 mb-2 font-semibold">
                                Focus Point 1 <span class="text-xs text-slate-400">(Required)</span>
                            </label>
                            <input type="text" id="focusPoint1" placeholder="Economy, National Security, etc."
                                   class="w-full bg-slate-900 text-slate-100 p-3 rounded border border-slate-600 focus:border-amber-400 focus:outline-none">
                        </div>

                        <div>
                            <label class="block text-slate-300 mb-2 font-semibold">
                                Focus Point 2 <span class="text-xs text-slate-400">(Optional)</span>
                            </label>
                            <input type="text" id="focusPoint2" placeholder="Indo-Pacific Relations, Climate, etc."
                                   class="w-full bg-slate-900 text-slate-100 p-3 rounded border border-slate-600 focus:border-amber-400 focus:outline-none">
                        </div>

                        <div>
                            <label class="block text-slate-300 mb-2">
                                Evidence per Focus Point: <span id="evidenceDisplay">3</span>
                            </label>
                            <input type="range" id="evidencePerPoint" min="1" max="5" value="3" class="w-full">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>1</span>
                                <span>5</span>
                            </div>
                        </div>

                        <button id="generateCaseBtn" 
                                class="w-full bg-amber-500 hover:bg-amber-600 disabled:bg-slate-600 text-slate-900 font-semibold py-3 rounded transition-colors flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            Generate Case
                        </button>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="bg-slate-800/50 backdrop-blur rounded-lg p-6 border border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-amber-400">Generated Case</h2>
                        <div id="caseActions" class="flex gap-2 hidden">
                            <button id="copyCaseBtn" class="p-2 bg-slate-700 hover:bg-slate-600 rounded transition-colors" title="Copy to clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-slate-300">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                            <button id="downloadCaseBtn" class="p-2 bg-slate-700 hover:bg-slate-600 rounded transition-colors" title="Download">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-slate-300">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="bg-slate-900 rounded p-4 h-96 overflow-y-auto border border-slate-600">
                        <p id="caseOutput" class="text-slate-400 italic generated-case">
                            Your generated debate case will appear here with properly formatted evidence, tags, and citations...
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSide = 'Aff';
        let parsedArgs = [];

        // Tab switching
        document.getElementById('counterTab').addEventListener('click', () => {
            document.getElementById('counterTab').className = 'px-6 py-3 rounded-lg font-semibold transition-colors bg-amber-500 text-slate-900';
            document.getElementById('caseTab').className = 'px-6 py-3 rounded-lg font-semibold transition-colors bg-slate-800 text-slate-300 hover:bg-slate-700';
            document.getElementById('counterSection').classList.remove('hidden');
            document.getElementById('caseSection').classList.add('hidden');
        });

        document.getElementById('caseTab').addEventListener('click', () => {
            document.getElementById('caseTab').className = 'px-6 py-3 rounded-lg font-semibold transition-colors bg-amber-500 text-slate-900';
            document.getElementById('counterTab').className = 'px-6 py-3 rounded-lg font-semibold transition-colors bg-slate-800 text-slate-300 hover:bg-slate-700';
            document.getElementById('caseSection').classList.remove('hidden');
            document.getElementById('counterSection').classList.add('hidden');
        });

        // Speech length slider
        document.getElementById('speechLength').addEventListener('input', (e) => {
            document.getElementById('speechLengthDisplay').textContent = e.target.value;
        });

        // Evidence slider
        document.getElementById('evidencePerPoint').addEventListener('input', (e) => {
            document.getElementById('evidenceDisplay').textContent = e.target.value;
        });

        // Side buttons
        document.getElementById('affBtn').addEventListener('click', () => {
            currentSide = 'Aff';
            document.getElementById('affBtn').className = 'flex-1 py-2 rounded font-semibold transition-colors bg-amber-500 text-slate-900';
            document.getElementById('negBtn').className = 'flex-1 py-2 rounded font-semibold transition-colors bg-slate-700 text-slate-300 hover:bg-slate-600';
        });

        document.getElementById('negBtn').addEventListener('click', () => {
            currentSide = 'Neg';
            document.getElementById('negBtn').className = 'flex-1 py-2 rounded font-semibold transition-colors bg-amber-500 text-slate-900';
            document.getElementById('affBtn').className = 'flex-1 py-2 rounded font-semibold transition-colors bg-slate-700 text-slate-300 hover:bg-slate-600';
        });

        // Parse rich text case
        function parseRichTextCase(htmlContent) {
            const args = [];
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const body = doc.body;

            const highlightedElements = [];
            const walker = document.createTreeWalker(body, NodeFilter.SHOW_ELEMENT, null, false);

            let node;
            while ((node = walker.nextNode())) {
                const bgColor = node.style.backgroundColor;
                const hasBackground = bgColor && bgColor !== 'transparent' && bgColor !== 'rgba(0, 0, 0, 0)' &&
                    bgColor !== 'rgb(255, 255, 255)' && bgColor !== '#ffffff' && bgColor !== 'white';
                
                const isHighlighted = node.tagName === 'MARK' || node.tagName === 'EM' || hasBackground ||
                    node.style.textDecoration?.includes('underline');

                if (isHighlighted) {
                    const text = node.textContent.trim();
                    if (text.length > 10) {
                        highlightedElements.push(text);
                    }
                }
            }

            const fullText = body.textContent;
            const lines = fullText.split('\n').map(l => l.trim()).filter(l => l);

            let currentArg = null;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const authorMatch = line.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+[''](\d{2}|\d{4})/);
                
                if (authorMatch) {
                    if (currentArg && currentArg.highlights.length > 0) {
                        args.push(currentArg);
                    }
                    currentArg = { author: authorMatch[0], tag: '', highlights: [] };
                    continue;
                }

                if (currentArg && !currentArg.tag) {
                    const tagMatch = line.match(/^\[([^\]]+)\]/) || line.match(/^([A-Z\s]{5,}[A-Z])$/);
                    if (tagMatch) {
                        currentArg.tag = tagMatch[1] || tagMatch[0];
                        continue;
                    }
                }
            }

            if (highlightedElements.length > 0) {
                if (currentArg) {
                    currentArg.highlights = highlightedElements;
                    args.push(currentArg);
                } else {
                    const authorMatch = fullText.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+[''](\d{2}|\d{4})/);
                    args.push({
                        author: authorMatch ? authorMatch[0] : 'Source citation',
                        tag: lines[0]?.substring(0, 100) || 'Main argument',
                        highlights: highlightedElements
                    });
                }
            }

            return args;
        }

        // Generate Counter-Speech
        document.getElementById('generateCounterBtn').addEventListener('click', async () => {
            const btn = document.getElementById('generateCounterBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="animate-spin h-5 w-5 border-2 border-slate-900 border-t-transparent rounded-full"></div> Generating...';

            const htmlContent = document.getElementById('caseInput').innerHTML;
            parsedArgs = parseRichTextCase(htmlContent);

            if (parsedArgs.length === 0) {
                document.getElementById('counterOutput').innerHTML = '<p class="text-slate-100 whitespace-pre-wrap">No arguments detected. Please ensure your case includes:\n- Author citations (e.g., Smith \'23)\n- Bolded tags\n- Highlighted evidence</p>';
                btn.disabled = false;
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg> Generate Counter-Speech';
                return;
            }

            // Display parsed args
            document.getElementById('parsedArgsDisplay').classList.remove('hidden');
            document.getElementById('argCount').textContent = parsedArgs.length;
            const argsList = document.getElementById('argsList');
            argsList.innerHTML = parsedArgs.map((arg, i) => `
                <div class="border-l-2 border-amber-500 pl-2">
                    <div class="font-semibold">${arg.tag || `Argument ${i + 1}`}</div>
                    <div class="text-slate-400">${arg.author}</div>
                    <div class="text-slate-500 text-xs mt-1">${arg.highlights.length} highlight${arg.highlights.length !== 1 ? 's' : ''} detected</div>
                </div>
            `).join('');

            const speechLength = document.getElementById('speechLength').value;
            const prompt = `You are a skilled debate coach. Generate a ${speechLength}-minute rebuttal speech against the following arguments. Be direct, analytical, and persuasive. Structure your speech with clear transitions.

Arguments to refute:
${parsedArgs.map((arg, i) => `
${i + 1}. ${arg.tag || 'Argument'}
Source: ${arg.author}
Key claims: ${arg.highlights.join(' ... ')}
`).join('\n')}

Generate a flowing ${speechLength}-minute speech that:
1. Briefly signposts the main refutations
2. Systematically addresses each argument with specific counterarguments
3. Points out logical flaws, questionable evidence, or alternative interpretations
4. Uses clear transitions between points
5. Concludes with impact analysis

Format as a natural speech, not bullet points. Target approximately ${speechLength * 150} words.`;

            try {
                // Using Hugging Face Inference API (free, no auth required for basic use)
                const response = await fetch('https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        inputs: `<s>[INST] ${prompt} [/INST]`,
                        parameters: {
                            max_new_tokens: 1000,
                            temperature: 0.7,
                            return_full_text: false
                        }
                    })
                });

                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.error) {
                    document.getElementById('counterOutput').innerHTML = `<p class="text-yellow-400">The AI model is loading (this can take 20-30 seconds on first use). Please try again in a moment.<br><br>Error: ${data.error}</p>`;
                } else if (data[0]?.generated_text) {
                    document.getElementById('counterOutput').innerHTML = `<p class="text-slate-100 whitespace-pre-wrap leading-relaxed">${data[0].generated_text}</p>`;
                    document.getElementById('counterActions').classList.remove('hidden');
                } else {
                    document.getElementById('counterOutput').innerHTML = `<p class="text-red-400">Unexpected response format: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('counterOutput').innerHTML = `<p class="text-red-400">Error: ${error.message}</p>`;
            }

            btn.disabled = false;
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg> Generate Counter-Speech';
        });

        // Generate Case
        document.getElementById('generateCaseBtn').addEventListener('click', async () => {
            const btn = document.getElementById('generateCaseBtn');
            const topic = document.getElementById('topic').value;
            const focusPoint1 = document.getElementById('focusPoint1').value;
            const focusPoint2 = document.getElementById('focusPoint2').value;
            const evidencePerPoint = document.getElementById('evidencePerPoint').value;

            const focusPoints = [focusPoint1, focusPoint2].filter(fp => fp.trim());

            if (!topic.trim() || focusPoints.length === 0) {
                document.getElementById('caseOutput').innerHTML = '<p class="text-red-400">Please provide a topic and at least one focus point.</p>';
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<div class="animate-spin h-5 w-5 border-2 border-slate-900 border-t-transparent rounded-full"></div> Generating Case...';

            const prompt = `You are an expert debate case writer. Generate a complete ${currentSide} case for the topic: "${topic}".

Focus points to cover: ${focusPoints.join(', ')}

For EACH focus point, create ${evidencePerPoint} pieces of evidence. Each piece of evidence should follow this structure:

1. CLAIM: A clear argument statement (1 per focus point that ties all evidence together)
2. TAG: A concise summary of what the evidence proves (this should be bolded)
3. CITATION: Realistic author and year (format: AuthorLastName 'YY) 
4. EVIDENCE: Full paragraph of evidence (150-250 words) that includes:
   - Background context
   - Key data, statistics, or expert analysis
   - LINK: Explanation of the causal mechanism (how/why the claim happens)
   - IMPACT: The consequence or outcome (what happens as a result)

CRITICAL FORMATTING INSTRUCTIONS:
- Write each piece of evidence as a complete, realistic academic paragraph
- Use HTML formatting: <strong> for tags and author citations, <mark> for 2-4 key sentences that contain the most important warrants/impacts
- The marked sections should highlight the crucial link and impact portions
- Make the evidence sound like real academic writing with proper sourcing style
- Ensure logical flow: Claim → Evidence → Link → Impact

Example format for ONE piece of evidence:

<strong>[TAG SUMMARIZING THE POINT]</strong>
<strong>AuthorLastName 'YY</strong>
Full paragraph of evidence here with context and background. <mark>This sentence contains the key link explaining the causal mechanism.</mark> Additional supporting details and analysis. <mark>This sentence delivers the critical impact showing why this matters.</mark> Concluding context that ties it together.

Generate the full ${currentSide} case now with ${evidencePerPoint} pieces of evidence per focus point.`;

            try {
                // Using Hugging Face Inference API (free, no auth required for basic use)
                const response = await fetch('https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        inputs: `<s>[INST] ${prompt} [/INST]`,
                        parameters: {
                            max_new_tokens: 2000,
                            temperature: 0.7,
                            return_full_text: false
                        }
                    })
                });

                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.error) {
                    document.getElementById('caseOutput').innerHTML = `<p class="text-yellow-400">The AI model is loading (this can take 20-30 seconds on first use). Please try again in a moment.<br><br>Error: ${data.error}</p>`;
                } else if (data[0]?.generated_text) {
                    document.getElementById('caseOutput').innerHTML = data[0].generated_text;
                    document.getElementById('caseActions').classList.remove('hidden');
                } else {
                    document.getElementById('caseOutput').innerHTML = `<p class="text-red-400">Unexpected response format: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('caseOutput').innerHTML = `<p class="text-red-400">Error: ${error.message}</p>`;
            }

            btn.disabled = false;
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg> Generate Case';
        });

        // Copy/Download functions
        document.getElementById('copyCounterBtn').addEventListener('click', () => {
            const text = document.getElementById('counterOutput').textContent;
            navigator.clipboard.writeText(text);
        });

        document.getElementById('downloadCounterBtn').addEventListener('click', () => {
            const text = document.getElementById('counterOutput').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hamilton-speech.txt';
            a.click();
        });

        document.getElementById('copyCaseBtn').addEventListener('click', () => {
            const htmlContent = document.getElementById('caseOutput').innerHTML;
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            const range = document.createRange();
            range.selectNodeContents(tempDiv);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            document.body.appendChild(tempDiv);
            document.execCommand('copy');
            document.body.removeChild(tempDiv);
            selection.removeAllRanges();
        });

        document.getElementById('downloadCaseBtn').addEventListener('click', () => {
            const text = document.getElementById('caseOutput').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'debate-case.txt';
            a.click();
        });

        // Paste handling for contenteditable
        document.getElementById('caseInput').addEventListener('paste', (e) => {
            e.preventDefault();
            const html = e.clipboardData.getData('text/html');
            const text = e.clipboardData.getData('text/plain');
            
            if (html) {
                document.execCommand('insertHTML', false, html);
            } else {
                document.execCommand('insertText', false, text);
            }
        });
    </script>
</body>
</html>
